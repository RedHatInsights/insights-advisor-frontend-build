"use strict";var currentPath=window.location.protocol+"//"+window.location.host+window.location.pathname,defaultSpecUrl=currentPath+"?format=openapi";function slugify(e){return e.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/--+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}var KEY_AUTH=slugify(window.location.pathname)+"-drf-yasg-auth",savedAuth=Immutable.fromJS({}),swaggerUiConfig={url:defaultSpecUrl,dom_id:"#swagger-ui",displayRequestDuration:!0,presets:[SwaggerUIBundle.presets.apis,SwaggerUIStandalonePreset],plugins:[SwaggerUIBundle.plugins.DownloadUrl],layout:"StandaloneLayout",filter:!0,requestInterceptor:function(e){var t=e.headers||{},r=document.querySelector("[name=csrfmiddlewaretoken]");return r&&(t["X-CSRFToken"]=r.value),e}};function patchSwaggerUi(){if(!document.querySelector(".auth-wrapper #django-session-auth")){var e=document.querySelector(".auth-wrapper"),t=document.querySelector(".auth-wrapper .authorize"),r=document.querySelector("#django-session-auth");r?(r=r.cloneNode(!0),e.insertBefore(r,t),r.classList.remove("hidden")):console.log("WARNING: session auth disabled")}}function initSwaggerUi(){if(window.ui)console.log("WARNING: skipping initSwaggerUi() because window.ui is already defined");else{document.querySelector(".auth-wrapper .authorize")?patchSwaggerUi():insertionQ(".auth-wrapper .authorize").every(patchSwaggerUi);var e=JSON.parse(document.getElementById("swagger-settings").innerHTML),t=document.getElementById("oauth2-redirect-url");t&&("oauth2RedirectUrl"in e||t&&(e.oauth2RedirectUrl=t.href),t.parentNode.removeChild(t)),console.log("swaggerSettings",e);var r=JSON.parse(document.getElementById("oauth2-config").innerHTML);console.log("oauth2Config",r),initSwaggerUiConfig(e,r),window.ui=SwaggerUIBundle(swaggerUiConfig),window.ui.initOAuth(r)}}function initSwaggerUiConfig(e,t){var r=e.persistAuth,a=e.refetchWithAuth,n=e.refetchOnLogout,o=e.fetchSchemaWithQuery;for(var i in delete e.persistAuth,delete e.refetchWithAuth,delete e.refetchOnLogout,delete e.fetchSchemaWithQuery,e)e.hasOwnProperty(i)&&(swaggerUiConfig[i]=e[i]);var u=swaggerUiConfig.url;if(o)for(var s=new URLSearchParams(window.location.search||"").entries(),c=s.next();!c.done;c=s.next())u=setQueryParam(u,c.value[0],c.value[1]);if(r)try{savedAuth=Immutable.fromJS(JSON.parse(localStorage.getItem(KEY_AUTH))||{})}catch(e){localStorage.removeItem(KEY_AUTH)}if(a&&(u=applyAuth(savedAuth,u)||u),swaggerUiConfig.url=u,r||a){var l=!1,g=swaggerUiConfig.onComplete;swaggerUiConfig.onComplete=function(){r&&preauthorizeAll(savedAuth,window.ui),l||(hookAuthActions(window.ui,r,a,n),l=!0),g&&g()};var h={},d=swaggerUiConfig.requestInterceptor;swaggerUiConfig.requestInterceptor=function(e){var t=e.headers||{};if(e.loadSpec){var r=e.url;if(a&&(r=applyAuth(savedAuth,r,t)||r),r!==e.url){e.url=r,window.ui?window.ui.specActions.updateUrl(e.url):setTimeout((function(){window.ui.specActions.updateUrl(e.url)}));var n=new URL(e.url,currentPath);h[n.href]=e.url}}return d&&(e=d(e)),e};var f=swaggerUiConfig.responseInterceptor;swaggerUiConfig.responseInterceptor=function(e){var t=new URL(e.url,currentPath);if(t.href in h){var r=h[t.href];delete h[t.href],e.ok&&setTimeout((function(){new URL(window.ui.specSelectors.url(),currentPath).href!==t.href&&window.ui.specActions.updateUrl(r)}))}return f&&(e=f(e)),e}}}function _usp(e,t){e=e.split("?");var r=new URLSearchParams(e[1]||"");return t(r),e[1]=r.toString(),e[1]?e.join("?"):e[0]}function setQueryParam(e,t,r){return _usp(e,(function(e){e.set(t,r)}))}function removeQueryParam(e,t){return _usp(e,(function(e){e.delete(t)}))}function preauthorizeAll(e,t){e.valueSeq().forEach((function(e){var r=e.get("name"),a=e.getIn(["schema","type"]);if("basic"===a&&r){var n=e.getIn(["value","username"]),o=e.getIn(["value","password"]);n&&o&&t.preauthorizeBasic(r,n,o)}else if("apiKey"===a&&r){var i=e.get("value");i&&t.preauthorizeApiKey(r,i)}}))}function applyAuth(e,t,r){return e.valueSeq().forEach((function(e){r=r||{};var a=e.get("name"),n=e.getIn(["schema","type"]);if("basic"===n&&a){var o=e.getIn(["value","username"]),i=e.getIn(["value","password"]);o&&i&&(r.Authorization="Basic "+btoa(o+":"+i))}else if("apiKey"===n&&a){var u=e.getIn(["schema","in"]),s=e.getIn(["schema","name"]),c=e.get("value");c&&s&&("header"===u&&(r[s]=c),"query"===u&&(t?t=setQueryParam(t,s,c):console.warn("WARNING: cannot apply apiKey query parameter via interceptor")))}})),t}function deauthUrl(e,t){return e.valueSeq().forEach((function(e){if("apiKey"===e.getIn(["schema","type"])){var r=e.getIn(["schema","in"]),a=e.getIn(["schema","name"]);"query"===r&&t&&a&&(t=removeQueryParam(t,a))}})),t}function hookAuthActions(e,t,r,a){if(t||r){var n=e.authActions.authorize;e.authActions.authorize=function(a){n(a);var o=Immutable.fromJS(a);if(savedAuth=savedAuth.merge(o),r){var i=e.specSelectors.url();i=applyAuth(savedAuth,i)||i,e.specActions.updateUrl(i),e.specActions.download(),e.authActions.showDefinitions()}t&&localStorage.setItem(KEY_AUTH,JSON.stringify(savedAuth.toJSON()))};var o=e.authActions.logout;e.authActions.logout=function(a){var n=savedAuth.filter((function(e,t){return-1!==a.indexOf(t)})).mapEntries((function(e){return[e[0],e[1].set("value",null)]}));if(savedAuth=savedAuth.filter((function(e,t){return-1===a.indexOf(t)})),r){var i=e.specSelectors.url();i=deauthUrl(n,i)||i,e.specActions.updateUrl(i),e.specActions.download(i),e.authActions.showDefinitions()}t&&localStorage.setItem(KEY_AUTH,JSON.stringify(savedAuth.toJSON())),o(a)}}}window.addEventListener("load",initSwaggerUi);