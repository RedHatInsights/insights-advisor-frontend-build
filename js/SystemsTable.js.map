{"version":3,"sources":["webpack:///./src/PresentationalComponents/SystemsTable/SystemsTable.js"],"names":["SystemsTable","systemsFetchStatus","fetchSystems","systems","intl","useState","title","formatMessage","messages","name","transforms","sortable","numberRuleHits","cellWidth","lastSeen","cols","rows","setRows","sortBy","setSortBy","sort","setSort","limit","setLimit","offset","setOffset","results","meta","count","searchText","setSearchText","debouncedSearchText","debounce","onSort","useCallback","_event","index","direction","orderParam","0","1","2","onSetPage","pageNumber","fetchAction","useEffect","length","display_name","data","flatMap","value","key","isOpen","system","cells","to","system_uuid","hits","moment","last_seen","fromNow","asMutable","icon","systemTableNoHitsTitle","text","systemTableNoHitsEnabledRulesBody","props","colSpan","filterConfigItems","label","filterValues","onChange","event","Fragment","pagination","itemCount","page","perPage","onPerPageSelect","isCompact","filterConfig","items","aria-label","message","systemTableFetchError","widgetId","variant","PaginationVariant","bottom","propTypes","PropTypes","func","string","object","addNotification","history","any","injectIntl","routerParams","connect","state","ownProps","AdvisorStore","dispatch","url","AppActions"],"mappings":"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","file":"js/SystemsTable.js","sourcesContent":["/* eslint camelcase: 0 */\nimport React, { useCallback, useEffect, useState } from 'react';\nimport { TableToolbar, PrimaryToolbar } from '@redhat-cloud-services/frontend-components';\nimport routerParams from '@redhat-cloud-services/frontend-components-utilities/files/RouterParams';\nimport PropTypes from 'prop-types';\nimport moment from 'moment';\nimport { Link } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport { Pagination, PaginationVariant } from '@patternfly/react-core';\nimport { cellWidth, sortable, Table, TableBody, TableHeader } from '@patternfly/react-table';\nimport { addNotification } from '@redhat-cloud-services/frontend-components-notifications';\nimport { injectIntl } from 'react-intl';\n\nimport * as AppActions from '../../AppActions';\nimport Loading from '../Loading/Loading';\nimport Failed from '../Loading/Failed';\nimport MessageState from '../MessageState/MessageState';\nimport debounce from '../../Utilities/Debounce';\nimport messages from '../../Messages';\n\nconst SystemsTable = ({ systemsFetchStatus, fetchSystems, systems, intl }) => {\n    const [cols] = useState([\n        { title: intl.formatMessage(messages.name), transforms: [sortable] },\n        { title: intl.formatMessage(messages.numberRuleHits), transforms: [sortable, cellWidth(15)] },\n        { title: intl.formatMessage(messages.lastSeen), transforms: [sortable] }\n    ]);\n    const [rows, setRows] = useState([]);\n    const [sortBy, setSortBy] = useState({});\n    const [sort, setSort] = useState('-last_seen');\n    const [limit, setLimit] = useState(10);\n    const [offset, setOffset] = useState(0);\n    const results = systems.meta ? systems.meta.count : 0;\n    const [searchText, setSearchText] = useState(null);\n    const debouncedSearchText = debounce(searchText, 800);\n\n    const onSort = useCallback((_event, index, direction) => {\n        const attrIndex = {\n            0: 'display_name',\n            1: 'hits',\n            2: 'last_seen'\n        };\n        const orderParam = `${direction === 'asc' ? '' : '-'}${attrIndex[index]}`;\n        setSortBy({ index, direction });\n        setSort(orderParam);\n        setOffset(0);\n    }, [setSort, setSortBy, setOffset]);\n\n    const onSetPage = (pageNumber) => {\n        const newOffset = pageNumber * limit - limit;\n        setOffset(newOffset);\n    };\n\n    const fetchAction = useCallback(() => {\n        setOffset(0);\n    }, []);\n\n    useEffect(() => {\n        searchText !== null && fetchSystems(searchText.length && { display_name: searchText, sort });\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [debouncedSearchText]);\n\n    useEffect(() => {\n        fetchSystems({\n            offset,\n            limit,\n            sort\n        });\n    }, [fetchSystems, limit, offset, sort]);\n\n    useEffect(() => {\n        !rows.length && onSort(null, 2, 'desc');\n    }, [onSort, rows.length]);\n\n    useEffect(() => {\n        if (systems.data) {\n            if (!systems.meta.count) {\n                setRows([{\n                    cells: [{\n                        title: (\n                            <MessageState icon='none' title={intl.formatMessage(messages.systemTableNoHitsTitle)}\n                                text={intl.formatMessage(messages.systemTableNoHitsEnabledRulesBody)}>\n                            </MessageState>),\n                        props: { colSpan: 5 }\n                    }]\n                }]);\n            } else {\n                const rows = systems.data.flatMap((value, key) => ([{\n                    isOpen: false,\n                    system: value,\n                    cells: [\n                        {\n                            title: <Link key={key} to={`/rules/systems/${value.system_uuid}`}>\n                                {value.display_name}\n                            </Link>\n                        }, {\n                            title: <div key={key}> {value.hits}</div>\n                        }, {\n                            title: <div key={key}>\n                                {moment(value.last_seen).fromNow()}\n                            </div>\n                        }\n                    ]\n                }\n                ]));\n                setRows(rows.asMutable());\n            }\n        }\n    }, [fetchAction, intl, systems]);\n\n    const filterConfigItems = [{\n        label: intl.formatMessage(messages.name),\n        filterValues: {\n            key: 'text-filter',\n            onChange: (event, value) => setSearchText(value),\n            value: searchText\n        }\n    }];\n\n    return <React.Fragment>\n        <PrimaryToolbar\n            pagination={{\n                itemCount: results,\n                page: offset / limit + 1,\n                perPage: limit,\n                onSetPage(event, page) { onSetPage(page); },\n                onPerPageSelect(event, perPage) { setLimit(perPage); },\n                isCompact: false\n            }}\n            filterConfig={{ items: filterConfigItems }}\n        />\n        {systemsFetchStatus === 'fulfilled' &&\n            <Table aria-label={'rule-table'} sortBy={sortBy} onSort={onSort} cells={cols} rows={rows}>\n                <TableHeader />\n                <TableBody />\n            </Table>\n        }\n        {systemsFetchStatus === 'pending' && (<Loading />)}\n        {systemsFetchStatus === 'failed' && (<Failed message={intl.formatMessage(messages.systemTableFetchError)} />)}\n        <TableToolbar>\n            <Pagination\n                itemCount={results}\n                perPage={limit}\n                page={(offset / limit + 1)}\n                onSetPage={(event, page) => { onSetPage(page); }}\n                widgetId={`pagination-options-menu-bottom`}\n                variant={PaginationVariant.bottom}\n            />\n        </TableToolbar>\n    </React.Fragment>;\n};\n\nSystemsTable.propTypes = {\n    fetchSystems: PropTypes.func,\n    systemsFetchStatus: PropTypes.string,\n    systems: PropTypes.object,\n    addNotification: PropTypes.func,\n    history: PropTypes.object,\n    intl: PropTypes.any\n};\n\nconst mapStateToProps = (state, ownProps) => ({\n    systems: state.AdvisorStore.systems,\n    systemsFetchStatus: state.AdvisorStore.systemsFetchStatus,\n    ...ownProps\n});\n\nconst mapDispatchToProps = dispatch => ({\n    fetchSystems: (url) => dispatch(AppActions.fetchSystems(url)),\n    addNotification: data => dispatch(addNotification(data))\n});\n\nexport default injectIntl(routerParams(connect(\n    mapStateToProps,\n    mapDispatchToProps\n)(SystemsTable)));\n"],"sourceRoot":""}