(self.webpackChunkadvisor_frontend=self.webpackChunkadvisor_frontend||[]).push([[384],{9946:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>ee});var r=a(92137),l=a(85061),n=a(96156),i=a(28481),o=a(87757),s=a.n(o),c=a(57149),u=a(59303),E=a(16530),m=a(13877),f=a(93264),d=a.n(f),T=a(88292),R=a(94550),p=a(76004),I=a(97109),_=a(88931),b=a(71094),g=a(61829),S=a(84785),y=a(6202),v=a(63732),k=a(15914),C=a(42293),A=a(26407),O=a(99332),h=a(69507),L=a(45697),Z=a.n(L),F=a(30893),G=a(86896),P=function(e){var t,a=e.labelList,r=(0,G.Z)(),l=(t=a.map((function(e){return e.id})),Object.entries(t.reduce((function(e,t){return e[t]=(e[t]||0)+1,e}),{})).sort((function(e,t){return t[1]-e[1]}))),n=function(e,t){return d().createElement(C.Label,{icon:e,variant:"outline",color:"blue"},t)};return d().createElement(A.e,{numLabels:1},l.map((function(e){return function(e){return 1===e?n(d().createElement(v.ZP,null),r.formatMessage(F.Z.availability)):2===e?n(d().createElement(O.ZP,null),r.formatMessage(F.Z.security)):3===e?n(d().createElement(k.ZP,null),r.formatMessage(F.Z.stability)):4===e?n(d().createElement(h.ZP,null),r.formatMessage(F.Z.performance)):void 0}(Number(e[0]))})))};P.propTypes={labelList:Z().array};const M=P;var x=a(35451),w=a(62410),D=a(44788),N=a(76341),j=a(78216),B=a(46891),V=a(86350),H=a(34702),W=a(57277),Y=a(87533),K=a(83808),U=a(95358),q=a(71355);var z=a(58921),J=a(28186),Q=a(43707);function X(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function $(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?X(Object(a),!0).forEach((function(t){(0,n.Z)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):X(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const ee=function(){var e,t,a=(0,G.Z)(),o=(0,_.useDispatch)(),v=(0,E.useLocation)().search,k=(0,Q.T)("advisor",u.PERMS.export).hasAccess,C=(0,Q.T)("advisor",u.PERMS.disableRec).hasAccess,A=(0,f.useState)([{title:a.formatMessage(F.Z.name),transforms:[R.sortable,(0,R.cellWidth)(40)]},{title:a.formatMessage(F.Z.added),transforms:[R.sortable,(0,R.cellWidth)(10)]},{title:a.formatMessage(F.Z.category),transforms:[R.sortable,(0,R.cellWidth)(10)]},{title:a.formatMessage(F.Z.totalRisk),transforms:[R.sortable,(0,R.cellWidth)(15)]},{title:a.formatMessage(F.Z.riskofchange),transforms:[R.sortable,(0,R.cellWidth)(15)]},{title:a.formatMessage(F.Z.systems),transforms:[R.sortable,(0,R.cellWidth)(15)]},{title:d().createElement(d().Fragment,null,d().createElement(g.ZP,{size:"md"})," ",a.formatMessage(F.Z.ansible)),transforms:[R.sortable,(0,R.cellWidth)(15),R.fitContent],dataLabel:a.formatMessage(F.Z.ansible)}]),O=(0,i.Z)(A,1)[0],h=(0,_.useSelector)((function(e){return e.AdvisorStore.rules})),L=(0,_.useSelector)((function(e){return e.AdvisorStore.rulesFetchStatus})),Z=(0,_.useSelector)((function(e){return e.AdvisorStore.filters})),P=(0,_.useSelector)((function(e){return e.AdvisorStore.selectedTags})),X=(0,_.useSelector)((function(e){return e.AdvisorStore.workloads})),ee=(0,_.useSelector)((function(e){return e.AdvisorStore.SID})),te=(0,f.useState)([]),ae=(0,i.Z)(te,2),re=ae[0],le=ae[1],ne=(0,f.useState)({}),ie=(0,i.Z)(ne,2),oe=ie[0],se=ie[1],ce=(0,f.useState)(!0),ue=(0,i.Z)(ce,2),Ee=ue[0],me=ue[1],fe=(0,f.useState)((null==Z?void 0:Z.text)||""),de=(0,i.Z)(fe,2),Te=de[0],Re=de[1],pe=(0,f.useState)(!1),Ie=(0,i.Z)(pe,2),_e=Ie[0],be=Ie[1],ge=(0,f.useState)({}),Se=(0,i.Z)(ge,2),ye=Se[0],ve=Se[1],ke=(0,f.useState)(!1),Ce=(0,i.Z)(ke,2),Ae=Ce[0],Oe=Ce[1],he=(0,f.useState)({}),Le=(0,i.Z)(he,2),Ze=Le[0],Fe=Le[1],Ge=(0,f.useState)(!1),Pe=(0,i.Z)(Ge,2),Me=Pe[0],xe=Pe[1],we=function(e){return o((0,q.wN)(e))},De=function(e){return o(c.rr(e))},Ne=function(e,t){var a=(0,f.useState)(e),r=(0,i.Z)(a,2),l=r[0],n=r[1];return(0,f.useEffect)((function(){var a=setTimeout((function(){n(e)}),t);return function(){clearTimeout(a)}}),[t,e]),l}(Te,u.DEBOUNCE_DELAY),je=(null==h||null===(e=h.meta)||void 0===e?void 0:e.count)||0,Be={1:"description",2:"publish_date",3:"category",4:"total_risk",5:"resolution_risk",6:"impacted_count",7:"playbook_count"},Ve=function(e){var t=e.resolution_set.find((function(e){return e.system_type===u.SYSTEM_TYPES.rhel||u.SYSTEM_TYPES.ocp}));return t?t.resolution_risk.risk:void 0},He=(0,f.useCallback)((function(){(0,I.Y4)(Z,P);var e=(null==P?void 0:P.length)&&{tags:P.map((function(e){return encodeURIComponent(e)}))};return X&&(e=$($({},e),(0,I.s0)(X,ee))),function(e,t){return o(c.j(e,t))}(e.tags?{}:$($({},(0,I.qW)(Z)),e),e.tags&&(0,I.gs)($($({},(0,I.qW)(Z)),e)))}),[Z,P,X,ee,o]),We=function(e){var t=e*Z.limit-Z.limit;De($($({},Z),{},{offset:t}))},Ye=function(e){De($($({},Z),{},{rule_status:e,offset:0},"enabled"!==e&&{impacting:["false"]}))},Ke=function(){var e=(0,r.Z)(s().mark((function e(t){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=re[t].rule,e.prev=1,"enabled"!==r.rule_status){e.next=7;break}ve(r),be(!0),e.next=17;break;case 7:return e.prev=7,e.next=10,b.Z.delete("".concat(u.BASE_URL,"/ack/").concat(r.rule_id,"/"));case 10:we({variant:"success",timeout:!0,dismissable:!0,title:a.formatMessage(F.Z.recSuccessfullyEnabled)}),He(),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(7),we({variant:"danger",dismissable:!0,title:a.formatMessage(F.Z.error),description:"".concat(e.t0)});case 17:e.next=22;break;case 19:e.prev=19,e.t1=e.catch(1),we({variant:"danger",dismissable:!0,title:"enabled"===r.rule_status?a.formatMessage(F.Z.rulesTableHideReportsErrorDisabled):a.formatMessage(F.Z.rulesTableHideReportsErrorEnabled),description:"".concat(e.t1)});case 22:case"end":return e.stop()}}),e,null,[[1,19],[7,14]])})));return function(t){return e.apply(this,arguments)}}(),Ue=function(e){switch(e){case"enabled":return F.Z.rulesTableNoRuleHitsEnabledRulesBody;case"disabled":return F.Z.rulesTableNoRuleHitsDisabledRulesBody;case"rhdisabled":return F.Z.rulesTableNoRuleHitsRedHatDisabledRulesBody;default:return F.Z.noRecommendations}};(0,f.useEffect)((function(){Ee||null===P||He()}),[He,Ee,Z,P]),(0,f.useEffect)((function(){if(v&&Ee){var e=(0,I.yG)();delete e.tags,void 0===e.text?Re(""):Re(e.text),e.sort=void 0===e.sort?"-total_risk":e.sort[0],void 0!==e.has_playbook&&!Array.isArray(e.has_playbook)&&(e.has_playbook=["".concat(e.has_playbook)]),void 0!==e.incident&&!Array.isArray(e.incident)&&(e.incident=["".concat(e.incident)]),void 0===e.offset?e.offset=0:e.offset=Number(e.offset[0]),void 0===e.limit?e.limit=20:e.limit=Number(e.limit[0]),void 0!==e.reboot&&!Array.isArray(e.reboot)&&(e.reboot=["".concat(e.reboot)]),void 0!==e.impacting&&!Array.isArray(e.impacting)&&(e.impacting=["".concat(e.impacting)]),De($($({},Z),e))}me(!1)}),[]),(0,f.useEffect)((function(){if(void 0!==Z.sort){var e=Number(Object.entries(Be).find((function(e){return e[1]===Z.sort||"-".concat(e[1])===Z.sort}))[0]),t="-"===Z.sort[0]?"desc":"asc";se({index:e,direction:t})}}),[Z.sort]),(0,f.useEffect)((function(){if(h.data)if(0===h.data.length)le([{cells:[{title:d().createElement(H.Z,{icon:x.default,iconClass:"ansibleCheck",title:a.formatMessage(F.Z.rulesTableNoRuleHitsTitle),text:a.formatMessage(Ue(Z.rule_status))},"enabled"===Z.rule_status&&d().createElement(y.Button,{variant:"link",style:{paddingTop:24},onClick:function(){return Ye("all")}},a.formatMessage(F.Z.rulesTableNoRuleHitsAddDisabledButton))),props:{colSpan:6}}]}]);else{var e=h.data.flatMap((function(e,t){return[{isOpen:Me,rule:e,cells:[{title:d().createElement("span",{key:t},d().createElement(E.Link,{key:t,to:"/recommendations/".concat(e.rule_id)}," ",e.description," "),d().createElement(K.Z,{rule:e}))},{title:d().createElement(w.Z,{key:t,date:e.publish_date,variant:"relative"})},{title:d().createElement(M,{key:t,labelList:[e.category]})},{title:d().createElement("div",{key:t},d().createElement(p.Tooltip,{key:t,position:p.TooltipPosition.bottom,content:a.formatMessage(F.Z.rulesDetailsTotalriskBody,{risk:u.TOTAL_RISK_LABEL_LOWER[e.total_risk]||a.formatMessage(F.Z.undefined),strong:function(e){return(0,J.f)(e)}})},d().createElement(j.Z,{value:e.total_risk})))},{title:d().createElement("div",{key:t},d().createElement(j.Z,{text:u.RISK_OF_CHANGE_LABEL[Ve(e)],value:Ve(e),hideIcon:!0}),d().createElement("div",null))},{title:"rhdisabled"===e.rule_status?d().createElement(p.Tooltip,{content:a.formatMessage(F.Z.byEnabling,{systems:e.impacted_systems_count})},d().createElement("span",null,a.formatMessage(F.Z.nA))):d().createElement("div",{key:t},"".concat(e.impacted_systems_count.toLocaleString()))},{title:d().createElement("div",{className:"ins-c-center-text ",key:t},e.playbook_count?d().createElement(x.default,{className:"ansibleCheck"}):a.formatMessage(F.Z.no))}]},{parent:2*t,fullWidth:!0,cells:[{title:d().createElement(V.Z,{className:"pf-m-light"},d().createElement(T.Stack,{hasGutter:!0},e.hosts_acked_count?d().createElement(T.StackItem,null,d().createElement(S.ZP,{size:"sm"})," ",e.hosts_acked_count&&!e.impacted_systems_count?a.formatMessage(F.Z.ruleIsDisabledForAllSystems):a.formatMessage(F.Z.ruleIsDisabledForSystemsBody,{systems:e.hosts_acked_count})," "," ",d().createElement(y.Button,{isInline:!0,variant:"link",ouiaId:"viewSystem",onClick:function(){Fe(e),Oe(!0)}},a.formatMessage(F.Z.viewSystems))):d().createElement(d().Fragment,null),d().createElement(Y.Z,{rule:e,resolutionRisk:Ve(e)})))}]}]}));le(e.asMutable())}}),[h]),(0,f.useEffect)((function(){if(!Ee&&"pending"!==L){var e=$({},Z),t=Te.length?{text:Te}:{};delete e.text,De($($($({},e),t),{},{offset:0}))}}),[Ne]);var qe,ze=function(e){var t=$($({},Z),{},{offset:0});"text"===e&&Re(""),delete t[e],De(t)},Je=function(e,t){t.length>0?De($($({},Z),{},{offset:0},(0,n.Z)({},e,t))):ze(e)},Qe=[{label:a.formatMessage(F.Z.name).toLowerCase(),filterValues:{key:"text-filter",onChange:function(e,t){return Re(t)},value:Te,placeholder:a.formatMessage(F.Z.filterBy)}},{label:u.FILTER_CATEGORIES.total_risk.title,type:u.FILTER_CATEGORIES.total_risk.type,id:u.FILTER_CATEGORIES.total_risk.urlParam,value:"checkbox-".concat(u.FILTER_CATEGORIES.total_risk.urlParam),filterValues:{key:"".concat(u.FILTER_CATEGORIES.total_risk.urlParam,"-filter"),onChange:function(e,t){return Je(u.FILTER_CATEGORIES.total_risk.urlParam,t)},value:Z.total_risk,items:u.FILTER_CATEGORIES.total_risk.values}},{label:u.FILTER_CATEGORIES.res_risk.title,type:u.FILTER_CATEGORIES.res_risk.type,id:u.FILTER_CATEGORIES.res_risk.urlParam,value:"checkbox-".concat(u.FILTER_CATEGORIES.res_risk.urlParam),filterValues:{key:"".concat(u.FILTER_CATEGORIES.res_risk.urlParam,"-filter"),onChange:function(e,t){return Je(u.FILTER_CATEGORIES.res_risk.urlParam,t)},value:Z.res_risk,items:u.FILTER_CATEGORIES.res_risk.values}},{label:u.FILTER_CATEGORIES.impact.title,type:u.FILTER_CATEGORIES.impact.type,id:u.FILTER_CATEGORIES.impact.urlParam,value:"checkbox-".concat(u.FILTER_CATEGORIES.impact.urlParam),filterValues:{key:"".concat(u.FILTER_CATEGORIES.impact.urlParam,"-filter"),onChange:function(e,t){return Je(u.FILTER_CATEGORIES.impact.urlParam,t)},value:Z.impact,items:u.FILTER_CATEGORIES.impact.values}},{label:u.FILTER_CATEGORIES.likelihood.title,type:u.FILTER_CATEGORIES.likelihood.type,id:u.FILTER_CATEGORIES.likelihood.urlParam,value:"checkbox-".concat(u.FILTER_CATEGORIES.likelihood.urlParam),filterValues:{key:"".concat(u.FILTER_CATEGORIES.likelihood.urlParam,"-filter"),onChange:function(e,t){return Je(u.FILTER_CATEGORIES.likelihood.urlParam,t)},value:Z.likelihood,items:u.FILTER_CATEGORIES.likelihood.values}},{label:u.FILTER_CATEGORIES.category.title,type:u.FILTER_CATEGORIES.category.type,id:u.FILTER_CATEGORIES.category.urlParam,value:"checkbox-".concat(u.FILTER_CATEGORIES.category.urlParam),filterValues:{key:"".concat(u.FILTER_CATEGORIES.category.urlParam,"-filter"),onChange:function(e,t){return Je(u.FILTER_CATEGORIES.category.urlParam,t)},value:Z.category,items:u.FILTER_CATEGORIES.category.values}},{label:u.FILTER_CATEGORIES.incident.title,type:u.FILTER_CATEGORIES.incident.type,id:u.FILTER_CATEGORIES.incident.urlParam,value:"checkbox-".concat(u.FILTER_CATEGORIES.incident.urlParam),filterValues:{key:"".concat(u.FILTER_CATEGORIES.incident.urlParam,"-filter"),onChange:function(e,t){return Je(u.FILTER_CATEGORIES.incident.urlParam,t)},value:Z.incident,items:u.FILTER_CATEGORIES.incident.values}},{label:u.FILTER_CATEGORIES.has_playbook.title,type:u.FILTER_CATEGORIES.has_playbook.type,id:u.FILTER_CATEGORIES.has_playbook.urlParam,value:"checkbox-".concat(u.FILTER_CATEGORIES.has_playbook.urlParam),filterValues:{key:"".concat(u.FILTER_CATEGORIES.has_playbook.urlParam,"-filter"),onChange:function(e,t){return Je(u.FILTER_CATEGORIES.has_playbook.urlParam,t)},value:Z.has_playbook,items:u.FILTER_CATEGORIES.has_playbook.values}},{label:u.FILTER_CATEGORIES.reboot.title,type:u.FILTER_CATEGORIES.reboot.type,id:u.FILTER_CATEGORIES.reboot.urlParam,value:"checkbox-".concat(u.FILTER_CATEGORIES.reboot.urlParam),filterValues:{key:"".concat(u.FILTER_CATEGORIES.reboot.urlParam,"-filter"),onChange:function(e,t){return Je(u.FILTER_CATEGORIES.reboot.urlParam,t)},value:Z.reboot,items:u.FILTER_CATEGORIES.reboot.values}},{label:u.FILTER_CATEGORIES.rule_status.title,type:u.FILTER_CATEGORIES.rule_status.type,id:u.FILTER_CATEGORIES.rule_status.urlParam,value:"radio-".concat(u.FILTER_CATEGORIES.rule_status.urlParam),filterValues:{key:"".concat(u.FILTER_CATEGORIES.rule_status.urlParam,"-filter"),onChange:function(e,t){return Ye(t)},value:"".concat(Z.rule_status),items:u.FILTER_CATEGORIES.rule_status.values}},{label:u.FILTER_CATEGORIES.impacting.title,type:u.FILTER_CATEGORIES.impacting.type,id:u.FILTER_CATEGORIES.impacting.urlParam,value:"checkbox-".concat(u.FILTER_CATEGORIES.impacting.urlParam),filterValues:{key:"".concat(u.FILTER_CATEGORIES.impacting.urlParam,"-filter"),onChange:function(e,t){return Je(u.FILTER_CATEGORIES.impacting.urlParam,t)},value:Z.impacting,items:u.FILTER_CATEGORIES.impacting.values}}],Xe={deleteTitle:a.formatMessage(F.Z.resetFilters),filters:(qe=$({},Z),delete qe.topic,delete qe.sort,delete qe.offset,delete qe.limit,(0,I.yK)(qe,u.FILTER_CATEGORIES)),onDelete:function(e,t,a){a?(Re(""),De($($({},Z.topic&&{topic:Z.topic}),{},{impacting:["true"],rule_status:"enabled",limit:Z.limit,offset:Z.offset}))):t.map((function(e){var t=(0,n.Z)({},e.urlParam,Array.isArray(Z[e.urlParam])?Z[e.urlParam].filter((function(t){return String(t)!==String(e.chips[0].value)})):"");t[e.urlParam].length>0?De($($({},Z),t)):ze(e.urlParam)}))}};return d().createElement(d().Fragment,null,Ae&&d().createElement(U.Z,{handleModalToggle:function(e){return Oe(e)},isModalOpen:Ae,afterFn:function(){He()},rule:Ze}),_e&&d().createElement(D.Z,{handleModalToggle:be,isModalOpen:_e,rule:ye,afterFn:He}),d().createElement(W.Z,{expandAll:{isAllExpanded:Me,onClick:function(e,t){var a=(0,l.Z)(re);xe(t),a.map((function(e,r){Object.prototype.hasOwnProperty.call(e,"isOpen")&&(a[r]=$($({},e),{},{isOpen:t}))})),le(a)}},pagination:{itemCount:je,page:Z.offset/Z.limit+1,perPage:Number(Z.limit),onSetPage:function(e,t){We(t)},onPerPageSelect:function(e,t){De($($({},Z),{},{limit:t,offset:0}))},isCompact:!0},exportConfig:(t={label:a.formatMessage(F.Z.exportCsv)},(0,n.Z)(t,"label",a.formatMessage(F.Z.exportJson)),(0,n.Z)(t,"onSelect",(function(e,t){return(0,z.Z)("hits",t,Z,P,X,ee)})),(0,n.Z)(t,"isDisabled",!k||!Z.impacting||Array.isArray(Z.impacting)&&!Z.impacting.every((function(e){return"true"===e}))),(0,n.Z)(t,"tooltipText",k?a.formatMessage(F.Z.exportData):a.formatMessage(F.Z.permsAction)),t),filterConfig:{items:Qe},activeFiltersConfig:Xe}),"fulfilled"===L&&d().createElement(R.Table,{"aria-label":"rule-table",variant:R.TableVariant.compact,actionResolver:function(e,t){var r=t.rowIndex,l=re[r].rule?re[r].rule:null;return r%2==0&&l?l&&"enabled"===l.rule_status?[{title:a.formatMessage(F.Z.disableRule),onClick:function(e,t){return Ke(t)}}]:[{title:a.formatMessage(F.Z.enableRule),onClick:function(e,t){return Ke(t)}}]:null},onCollapse:function(e,t,a){var r=(0,l.Z)(re);r[t]=$($({},r[t]),{},{isOpen:a}),le(r)},sortBy:oe,onSort:function(e,t,a){var r="".concat("asc"===a?"":"-").concat(Be[t]);se({index:t,direction:a}),De($($({},Z),{},{sort:r,offset:0}))},cells:O,rows:re,areActionsDisabled:function(){return!C},isStickyHeader:!0},d().createElement(R.TableHeader,null),d().createElement(R.TableBody,null)),"pending"===L&&d().createElement(B.Z,null),"failed"===L&&d().createElement(N.Z,{message:a.formatMessage(F.Z.rulesTableFetchRulesError)}),d().createElement(m.tl,{ouiaId:"page",itemCount:je,page:Z.offset/Z.limit+1,perPage:Number(Z.limit),onSetPage:function(e,t){We(t)},onPerPageSelect:function(e,t){De($($({},Z),{},{limit:t,offset:0}))},widgetId:"pagination-options-menu-bottom",variant:m.aM.bottom}))}}}]);
//# sourceMappingURL=../sourcemaps/RulesTable.7e784ed3f57d2cbb2bac.js.map