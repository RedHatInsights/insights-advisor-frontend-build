"use strict";(self.webpackChunkadvisor_frontend=self.webpackChunkadvisor_frontend||[]).push([[384],{69655:(e,t,a)=>{a.r(t),a.d(t,{default:()=>z});var r=a(15861),l=a(93433),n=a(4942),i=a(29439),o=a(87757),s=a.n(o),c=a(59303),u=a(16530),m=a(13877),f=a(93264),d=a.n(f),p=a(88292),b=a(78247),g=a(76004),y=a(97109),k=a(88931),v=a(61829),h=a(84785),W=a(6202),Z=a(81731),_=a(35451),P=a(62410),E=a(71094),M=a(44788),S=a(76341),x=a(78216),C=a(46891),O=a(86350),T=a(34702),w=a(57277),A=a(87533),R=a(83808),D=a(95358),N=a(71355);var j=a(58921),B=a(30893),V=a(28186),F=a(28672),H=a(75546),I=a(86896),L=a(43707);function G(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function q(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?G(Object(a),!0).forEach((function(t){(0,n.Z)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):G(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const z=function(){var e,t,a=(0,I.Z)(),o=(0,k.useDispatch)(),G=(0,u.useLocation)().search,z=(0,L.T)("advisor",c.Gd.export).hasAccess,Y=(0,L.T)("advisor",c.Gd.disableRec).hasAccess,J=(0,f.useState)([{title:a.formatMessage(B.Z.name),transforms:[b.sortable,(0,b.cellWidth)(40)]},{title:a.formatMessage(B.Z.added),transforms:[b.sortable,(0,b.cellWidth)(10)]},{title:a.formatMessage(B.Z.category),transforms:[b.sortable,(0,b.cellWidth)(10)]},{title:a.formatMessage(B.Z.totalRisk),transforms:[b.sortable,(0,b.cellWidth)(15)]},{title:a.formatMessage(B.Z.riskofchange),transforms:[b.sortable,(0,b.cellWidth)(15)]},{title:a.formatMessage(B.Z.systems),transforms:[b.sortable,(0,b.cellWidth)(15)]},{title:d().createElement(d().Fragment,null,d().createElement(v.ZP,{size:"md"})," ",a.formatMessage(B.Z.ansible)),transforms:[b.sortable,(0,b.cellWidth)(15),b.fitContent],dataLabel:a.formatMessage(B.Z.ansible)}]),K=(0,i.Z)(J,1)[0],$=(0,k.useSelector)((function(e){return e.filters.selectedTags})),Q=(0,k.useSelector)((function(e){return e.filters.workloads})),U=(0,k.useSelector)((function(e){return e.filters.SID})),X=(0,k.useSelector)((function(e){return e.filters.recState})),ee=(0,f.useState)([]),te=(0,i.Z)(ee,2),ae=te[0],re=te[1],le=(0,f.useState)({}),ne=(0,i.Z)(le,2),ie=ne[0],oe=ne[1],se=(0,f.useState)(!0),ce=(0,i.Z)(se,2),ue=ce[0],me=ce[1],fe=(0,f.useState)((null==X?void 0:X.text)||""),de=(0,i.Z)(fe,2),pe=de[0],be=de[1],ge=(0,f.useState)(!1),ye=(0,i.Z)(ge,2),ke=ye[0],ve=ye[1],he=(0,f.useState)({}),We=(0,i.Z)(he,2),Ze=We[0],_e=We[1],Pe=(0,f.useState)(!1),Ee=(0,i.Z)(Pe,2),Me=Ee[0],Se=Ee[1],xe=(0,f.useState)({}),Ce=(0,i.Z)(xe,2),Oe=Ce[0],Te=Ce[1],we=(0,f.useState)(!1),Ae=(0,i.Z)(we,2),Re=Ae[0],De=Ae[1],Ne=function(e){return o((0,N.wN)(e))},je=function(e){return o((0,F.hb)(e))},Be={};(null==$?void 0:$.length)&&(Be=q(q({},Be),{tags:$.join(",")})),Q&&(Be=q(q({},Be),(0,y.s0)(Q,U)));var Ve=(0,H.Bs)(q(q({},(0,y.qW)(X)),Be)),Fe=Ve.data,He=void 0===Fe?[]:Fe,Ie=Ve.isFetching,Le=Ve.isLoading,Ge=Ve.isError,qe=Ve.refetch,ze=function(e,t){var a=(0,f.useState)(e),r=(0,i.Z)(a,2),l=r[0],n=r[1];return(0,f.useEffect)((function(){var a=setTimeout((function(){n(e)}),t);return function(){clearTimeout(a)}}),[t,e]),l}(pe,c.$x),Ye=(null==He||null===(e=He.meta)||void 0===e?void 0:e.count)||0,Je={1:"description",2:"publish_date",3:"category",4:"total_risk",5:"resolution_risk",6:"impacted_count",7:"playbook_count"},Ke=function(e){var t=e.resolution_set.find((function(e){return e.system_type===c.CO.rhel||c.CO.ocp}));return t?t.resolution_risk.risk:void 0};(0,f.useEffect)((function(){ue||null===$||(0,y.Y4)(X,$)}),[X,$,Q,U]);var $e=function(e){var t=e*X.limit-X.limit;je(q(q({},X),{},{offset:t}))},Qe=function(e){je(q(q({},X),{},{rule_status:e,offset:0},"enabled"!==e&&{impacting:["false"]}))},Ue=function(){var e=(0,r.Z)(s().mark((function e(t){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=ae[t].rule,e.prev=1,"enabled"!==r.rule_status){e.next=7;break}_e(r),ve(!0),e.next=17;break;case 7:return e.prev=7,e.next=10,(0,E.Sp)("".concat(c._n,"/ack/").concat(r.rule_id,"/"));case 10:Ne({variant:"success",timeout:!0,dismissable:!0,title:a.formatMessage(B.Z.recSuccessfullyEnabled)}),qe(),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(7),Ne({variant:"danger",dismissable:!0,title:a.formatMessage(B.Z.error),description:"".concat(e.t0)});case 17:e.next=22;break;case 19:e.prev=19,e.t1=e.catch(1),Ne({variant:"danger",dismissable:!0,title:"enabled"===r.rule_status?a.formatMessage(B.Z.rulesTableHideReportsErrorDisabled):a.formatMessage(B.Z.rulesTableHideReportsErrorEnabled),description:"".concat(e.t1)});case 22:case"end":return e.stop()}}),e,null,[[1,19],[7,14]])})));return function(t){return e.apply(this,arguments)}}(),Xe=function(e){switch(e){case"enabled":return B.Z.rulesTableNoRuleHitsEnabledRulesBody;case"disabled":return B.Z.rulesTableNoRuleHitsDisabledRulesBody;case"rhdisabled":return B.Z.rulesTableNoRuleHitsRedHatDisabledRulesBody;default:return B.Z.noRecommendations}};(0,f.useEffect)((function(){if(G&&ue){var e=(0,y.yG)();delete e.tags,void 0===e.text?be(""):be(e.text),e.sort=void 0===e.sort?"-total_risk":e.sort[0],void 0!==e.has_playbook&&!Array.isArray(e.has_playbook)&&(e.has_playbook=["".concat(e.has_playbook)]),void 0!==e.incident&&!Array.isArray(e.incident)&&(e.incident=["".concat(e.incident)]),void 0===e.offset?e.offset=0:e.offset=Number(e.offset[0]),void 0===e.limit?e.limit=20:e.limit=Number(e.limit[0]),void 0!==e.reboot&&!Array.isArray(e.reboot)&&(e.reboot=["".concat(e.reboot)]),void 0!==e.impacting&&!Array.isArray(e.impacting)&&(e.impacting=["".concat(e.impacting)]),je(q(q({},X),e))}me(!1)}),[]),(0,f.useEffect)((function(){if(void 0!==X.sort){var e=Number(Object.entries(Je).find((function(e){return e[1]===X.sort||"-".concat(e[1])===X.sort}))[0]),t="-"===X.sort[0]?"desc":"asc";oe({index:e,direction:t})}}),[X.sort]),(0,f.useEffect)((function(){if(He.data)if(0===He.data.length)re([{cells:[{title:d().createElement(T.Z,{icon:_.default,iconClass:"ansibleCheck",title:a.formatMessage(B.Z.rulesTableNoRuleHitsTitle),text:a.formatMessage(Xe(X.rule_status))},"enabled"===X.rule_status&&d().createElement(W.Button,{variant:"link",style:{paddingTop:24},onClick:function(){return Qe("all")}},a.formatMessage(B.Z.rulesTableNoRuleHitsAddDisabledButton))),props:{colSpan:6}}]}]);else{var e=He.data.flatMap((function(e,t){return[{isOpen:Re,rule:e,cells:[{title:d().createElement("span",{key:t},d().createElement(u.Link,{key:t,to:"/recommendations/".concat(e.rule_id)}," ",e.description," "),d().createElement(R.Z,{rule:e}))},{title:d().createElement(P.Z,{key:t,date:e.publish_date,variant:"relative"})},{title:d().createElement(Z.Z,{key:t,labelList:[e.category]})},{title:d().createElement("div",{key:t},d().createElement(g.Tooltip,{key:t,position:g.TooltipPosition.bottom,content:a.formatMessage(B.Z.rulesDetailsTotalriskBody,{risk:c.Nq[e.total_risk]||a.formatMessage(B.Z.undefined),strong:function(e){return(0,V.f)(e)}})},d().createElement(x.Z,{value:e.total_risk})))},{title:d().createElement("div",{key:t},d().createElement(x.Z,{text:c.MS[Ke(e)],value:Ke(e),hideIcon:!0}),d().createElement("div",null))},{title:"rhdisabled"===e.rule_status?d().createElement(g.Tooltip,{content:a.formatMessage(B.Z.byEnabling,{systems:e.impacted_systems_count})},d().createElement("span",null,a.formatMessage(B.Z.nA))):d().createElement("div",{key:t},"".concat(e.impacted_systems_count.toLocaleString()))},{title:d().createElement("div",{className:"ins-c-center-text ",key:t},e.playbook_count?d().createElement(_.default,{className:"ansibleCheck"}):a.formatMessage(B.Z.no))}]},{parent:2*t,fullWidth:!0,cells:[{title:d().createElement(O.Z,{className:"pf-m-light"},d().createElement(p.Stack,{hasGutter:!0},e.hosts_acked_count?d().createElement(p.StackItem,null,d().createElement(h.ZP,{size:"sm"})," ",e.hosts_acked_count&&!e.impacted_systems_count?a.formatMessage(B.Z.ruleIsDisabledForAllSystems):a.formatMessage(B.Z.ruleIsDisabledForSystemsBody,{systems:e.hosts_acked_count})," "," ",d().createElement(W.Button,{isInline:!0,variant:"link",ouiaId:"viewSystem",onClick:function(){Te(e),Se(!0)}},a.formatMessage(B.Z.viewSystems))):d().createElement(d().Fragment,null),d().createElement(A.Z,{rule:e,resolutionRisk:Ke(e),riskOfChangeDesc:c.wY[Ke(e)]})))}]}]}));re(e)}}),[He]),(0,f.useEffect)((function(){if(!ue&&!Le){var e=q({},X),t=pe.length?{text:pe}:{};delete e.text,je(q(q(q({},e),t),{},{offset:0}))}}),[ze]);var et,tt=function(e){var t=q(q({},X),{},{offset:0});"text"===e&&be(""),delete t[e],je(t)},at=function(e,t){t.length>0?je(q(q({},X),{},{offset:0},(0,n.Z)({},e,t))):tt(e)},rt=[{label:a.formatMessage(B.Z.name).toLowerCase(),filterValues:{key:"text-filter",onChange:function(e,t){return be(t)},value:pe,placeholder:a.formatMessage(B.Z.filterBy)}},{label:c.W2.total_risk.title,type:c.W2.total_risk.type,id:c.W2.total_risk.urlParam,value:"checkbox-".concat(c.W2.total_risk.urlParam),filterValues:{key:"".concat(c.W2.total_risk.urlParam,"-filter"),onChange:function(e,t){return at(c.W2.total_risk.urlParam,t)},value:X.total_risk,items:c.W2.total_risk.values}},{label:c.W2.res_risk.title,type:c.W2.res_risk.type,id:c.W2.res_risk.urlParam,value:"checkbox-".concat(c.W2.res_risk.urlParam),filterValues:{key:"".concat(c.W2.res_risk.urlParam,"-filter"),onChange:function(e,t){return at(c.W2.res_risk.urlParam,t)},value:X.res_risk,items:c.W2.res_risk.values}},{label:c.W2.impact.title,type:c.W2.impact.type,id:c.W2.impact.urlParam,value:"checkbox-".concat(c.W2.impact.urlParam),filterValues:{key:"".concat(c.W2.impact.urlParam,"-filter"),onChange:function(e,t){return at(c.W2.impact.urlParam,t)},value:X.impact,items:c.W2.impact.values}},{label:c.W2.likelihood.title,type:c.W2.likelihood.type,id:c.W2.likelihood.urlParam,value:"checkbox-".concat(c.W2.likelihood.urlParam),filterValues:{key:"".concat(c.W2.likelihood.urlParam,"-filter"),onChange:function(e,t){return at(c.W2.likelihood.urlParam,t)},value:X.likelihood,items:c.W2.likelihood.values}},{label:c.W2.category.title,type:c.W2.category.type,id:c.W2.category.urlParam,value:"checkbox-".concat(c.W2.category.urlParam),filterValues:{key:"".concat(c.W2.category.urlParam,"-filter"),onChange:function(e,t){return at(c.W2.category.urlParam,t)},value:X.category,items:c.W2.category.values}},{label:c.W2.incident.title,type:c.W2.incident.type,id:c.W2.incident.urlParam,value:"checkbox-".concat(c.W2.incident.urlParam),filterValues:{key:"".concat(c.W2.incident.urlParam,"-filter"),onChange:function(e,t){return at(c.W2.incident.urlParam,t)},value:X.incident,items:c.W2.incident.values}},{label:c.W2.has_playbook.title,type:c.W2.has_playbook.type,id:c.W2.has_playbook.urlParam,value:"checkbox-".concat(c.W2.has_playbook.urlParam),filterValues:{key:"".concat(c.W2.has_playbook.urlParam,"-filter"),onChange:function(e,t){return at(c.W2.has_playbook.urlParam,t)},value:X.has_playbook,items:c.W2.has_playbook.values}},{label:c.W2.reboot.title,type:c.W2.reboot.type,id:c.W2.reboot.urlParam,value:"checkbox-".concat(c.W2.reboot.urlParam),filterValues:{key:"".concat(c.W2.reboot.urlParam,"-filter"),onChange:function(e,t){return at(c.W2.reboot.urlParam,t)},value:X.reboot,items:c.W2.reboot.values}},{label:c.W2.rule_status.title,type:c.W2.rule_status.type,id:c.W2.rule_status.urlParam,value:"radio-".concat(c.W2.rule_status.urlParam),filterValues:{key:"".concat(c.W2.rule_status.urlParam,"-filter"),onChange:function(e,t){return Qe(t)},value:"".concat(X.rule_status),items:c.W2.rule_status.values}},{label:c.W2.impacting.title,type:c.W2.impacting.type,id:c.W2.impacting.urlParam,value:"checkbox-".concat(c.W2.impacting.urlParam),filterValues:{key:"".concat(c.W2.impacting.urlParam,"-filter"),onChange:function(e,t){return at(c.W2.impacting.urlParam,t)},value:X.impacting,items:c.W2.impacting.values}}],lt={deleteTitle:a.formatMessage(B.Z.resetFilters),filters:(et=q({},X),delete et.topic,delete et.sort,delete et.offset,delete et.limit,(0,y.yK)(et,c.W2)),onDelete:function(e,t,a){a?(be(""),je(q(q({},X.topic&&{topic:X.topic}),{},{impacting:["true"],rule_status:"enabled",limit:X.limit,offset:X.offset}))):t.map((function(e){var t=(0,n.Z)({},e.urlParam,Array.isArray(X[e.urlParam])?X[e.urlParam].filter((function(t){return String(t)!==String(e.chips[0].value)})):"");t[e.urlParam].length>0?je(q(q({},X),t)):tt(e.urlParam)}))}};return d().createElement(d().Fragment,null,Me&&d().createElement(D.Z,{handleModalToggle:function(e){return Se(e)},isModalOpen:Me,afterFn:function(){qe()},rule:Oe}),ke&&d().createElement(M.Z,{handleModalToggle:ve,isModalOpen:ke,rule:Ze,afterFn:qe}),d().createElement(w.Z,{expandAll:{isAllExpanded:Re,onClick:function(e,t){var a=(0,l.Z)(ae);De(t),a.map((function(e,r){Object.prototype.hasOwnProperty.call(e,"isOpen")&&(a[r]=q(q({},e),{},{isOpen:t}))})),re(a)}},pagination:{itemCount:Ye,page:X.offset/X.limit+1,perPage:Number(X.limit),onSetPage:function(e,t){$e(t)},onPerPageSelect:function(e,t){je(q(q({},X),{},{limit:t,offset:0}))},isCompact:!0},exportConfig:(t={label:a.formatMessage(B.Z.exportCsv)},(0,n.Z)(t,"label",a.formatMessage(B.Z.exportJson)),(0,n.Z)(t,"onSelect",(function(e,t){return(0,j.Z)("hits",t,X,$,Q,U)})),(0,n.Z)(t,"isDisabled",!z||!X.impacting||Array.isArray(X.impacting)&&!X.impacting.every((function(e){return"true"===e}))),(0,n.Z)(t,"tooltipText",z?a.formatMessage(B.Z.exportData):a.formatMessage(B.Z.permsAction)),t),filterConfig:{items:rt},activeFiltersConfig:lt}),Ie?d().createElement(C.Z,null):Ge?d().createElement(S.Z,{message:a.formatMessage(B.Z.rulesTableFetchRulesError)}):d().createElement(b.Table,{"aria-label":"rule-table",variant:b.TableVariant.compact,actionResolver:function(e,t){var r=t.rowIndex,l=ae[r].rule?ae[r].rule:null;return r%2==0&&l?l&&"enabled"===l.rule_status?[{title:a.formatMessage(B.Z.disableRule),onClick:function(e,t){return Ue(t)}}]:[{title:a.formatMessage(B.Z.enableRule),onClick:function(e,t){return Ue(t)}}]:null},onCollapse:function(e,t,a){var r=(0,l.Z)(ae);r[t]=q(q({},r[t]),{},{isOpen:a}),re(r)},sortBy:ie,onSort:function(e,t,a){var r="".concat("asc"===a?"":"-").concat(Je[t]);oe({index:t,direction:a}),je(q(q({},X),{},{sort:r,offset:0}))},cells:K,rows:ae,areActionsDisabled:function(){return!Y},isStickyHeader:!0},d().createElement(b.TableHeader,null),d().createElement(b.TableBody,null)),d().createElement(m.tl,{ouiaId:"page",itemCount:Ye,page:X.offset/X.limit+1,perPage:Number(X.limit),onSetPage:function(e,t){$e(t)},onPerPageSelect:function(e,t){je(q(q({},X),{},{limit:t,offset:0}))},widgetId:"pagination-options-menu-bottom",variant:m.aM.bottom}))}}}]);
//# sourceMappingURL=../sourcemaps/RulesTable.baa6b9c739a0ec6b6f2d.js.map