"use strict";(self.webpackChunkadvisor_frontend=self.webpackChunkadvisor_frontend||[]).push([[384],{74560:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Y});var r=a(15861),l=a(93433),n=a(4942),i=a(29439),o=a(87757),s=a.n(o),c=a(59303),u=a(75662),m=a(13877),f=a(93264),d=a.n(f),p=a(88292),b=a(27577),g=a(76004),y=a(97109),k=a(82041),v=a(61829),h=a(84785),W=a(6202),Z=a(66584),_=a(35451),P=a(62410),E=a(71094),M=a(44788),S=a(76341),x=a(78216),C=a(46891),O=a(86350),T=a(34702),w=a(66031),A=a(87533),R=a(87516),D=a(95358),N=a(71355),j=a(40609),B=a(58921),V=a(30893),F=a(28186),H=a(28672),I=a(75546),L=a(86896),G=a(43707);function q(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function z(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?q(Object(a),!0).forEach((function(t){(0,n.Z)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):q(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const Y=function(){var e,t,a=(0,L.Z)(),o=(0,k.useDispatch)(),q=(0,u.useLocation)().search,Y=(0,G.T)("advisor",c.Gd.export).hasAccess,J=(0,G.T)("advisor",c.Gd.disableRec).hasAccess,K=(0,f.useState)([{title:a.formatMessage(V.Z.name),transforms:[b.sortable,(0,b.cellWidth)(40)]},{title:a.formatMessage(V.Z.added),transforms:[b.sortable,(0,b.cellWidth)(10)]},{title:a.formatMessage(V.Z.category),transforms:[b.sortable,(0,b.cellWidth)(10)]},{title:a.formatMessage(V.Z.totalRisk),transforms:[b.sortable,(0,b.cellWidth)(15)]},{title:a.formatMessage(V.Z.riskofchange),transforms:[b.sortable,(0,b.cellWidth)(15)]},{title:a.formatMessage(V.Z.systems),transforms:[b.sortable,(0,b.cellWidth)(15)]},{title:d().createElement(d().Fragment,null,d().createElement(v.ZP,{size:"md"})," ",a.formatMessage(V.Z.ansible)),transforms:[b.sortable,(0,b.cellWidth)(15),b.fitContent],dataLabel:a.formatMessage(V.Z.ansible)}]),$=(0,i.Z)(K,1)[0],Q=(0,k.useSelector)((function(e){return e.filters.selectedTags})),U=(0,k.useSelector)((function(e){return e.filters.workloads})),X=(0,k.useSelector)((function(e){return e.filters.SID})),ee=(0,k.useSelector)((function(e){return e.filters.recState})),te=(0,f.useState)([]),ae=(0,i.Z)(te,2),re=ae[0],le=ae[1],ne=(0,f.useState)({}),ie=(0,i.Z)(ne,2),oe=ie[0],se=ie[1],ce=(0,f.useState)(!0),ue=(0,i.Z)(ce,2),me=ue[0],fe=ue[1],de=(0,f.useState)((null==ee?void 0:ee.text)||""),pe=(0,i.Z)(de,2),be=pe[0],ge=pe[1],ye=(0,f.useState)(!1),ke=(0,i.Z)(ye,2),ve=ke[0],he=ke[1],We=(0,f.useState)({}),Ze=(0,i.Z)(We,2),_e=Ze[0],Pe=Ze[1],Ee=(0,f.useState)(!1),Me=(0,i.Z)(Ee,2),Se=Me[0],xe=Me[1],Ce=(0,f.useState)({}),Oe=(0,i.Z)(Ce,2),Te=Oe[0],we=Oe[1],Ae=(0,f.useState)(!1),Re=(0,i.Z)(Ae,2),De=Re[0],Ne=Re[1],je=function(e){return o((0,N.wN)(e))},Be=function(e){return o((0,H.hb)(e))},Ve={};(null==Q?void 0:Q.length)&&(Ve=z(z({},Ve),{tags:Q.join(",")})),U&&(Ve=z(z({},Ve),(0,y.s0)(U,X)));var Fe=(0,I.Bs)(z(z({},(0,y.qW)(ee)),Ve)),He=Fe.data,Ie=void 0===He?[]:He,Le=Fe.isFetching,Ge=Fe.isLoading,qe=Fe.isError,ze=Fe.refetch,Ye=(0,j.Z)(be,c.$x),Je=(null==Ie||null===(e=Ie.meta)||void 0===e?void 0:e.count)||0,Ke={1:"description",2:"publish_date",3:"category",4:"total_risk",5:"resolution_risk",6:"impacted_count",7:"playbook_count"},$e=function(e){var t=e.resolution_set.find((function(e){return e.system_type===c.CO.rhel||c.CO.ocp}));return t?t.resolution_risk.risk:void 0};(0,f.useEffect)((function(){me||null===Q||(0,y.Y4)(ee,Q)}),[ee,Q,U,X]);var Qe=function(e){var t=e*ee.limit-ee.limit;Be(z(z({},ee),{},{offset:t}))},Ue=function(e){Be(z(z({},ee),{},{rule_status:e,offset:0},"enabled"!==e&&{impacting:["false"]}))},Xe=function(){var e=(0,r.Z)(s().mark((function e(t){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=re[t].rule,e.prev=1,"enabled"!==r.rule_status){e.next=7;break}Pe(r),he(!0),e.next=17;break;case 7:return e.prev=7,e.next=10,(0,E.Sp)("".concat(c._n,"/ack/").concat(r.rule_id,"/"));case 10:je({variant:"success",timeout:!0,dismissable:!0,title:a.formatMessage(V.Z.recSuccessfullyEnabled)}),ze(),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(7),je({variant:"danger",dismissable:!0,title:a.formatMessage(V.Z.error),description:"".concat(e.t0)});case 17:e.next=22;break;case 19:e.prev=19,e.t1=e.catch(1),je({variant:"danger",dismissable:!0,title:"enabled"===r.rule_status?a.formatMessage(V.Z.rulesTableHideReportsErrorDisabled):a.formatMessage(V.Z.rulesTableHideReportsErrorEnabled),description:"".concat(e.t1)});case 22:case"end":return e.stop()}}),e,null,[[1,19],[7,14]])})));return function(t){return e.apply(this,arguments)}}(),et=function(e){switch(e){case"enabled":return V.Z.rulesTableNoRuleHitsEnabledRulesBody;case"disabled":return V.Z.rulesTableNoRuleHitsDisabledRulesBody;case"rhdisabled":return V.Z.rulesTableNoRuleHitsRedHatDisabledRulesBody;default:return V.Z.noRecommendations}};(0,f.useEffect)((function(){if(q&&me){var e=(0,y.yG)();delete e.tags,void 0===e.text?ge(""):ge(e.text),e.sort=void 0===e.sort?"-total_risk":e.sort[0],void 0!==e.has_playbook&&!Array.isArray(e.has_playbook)&&(e.has_playbook=["".concat(e.has_playbook)]),void 0!==e.incident&&!Array.isArray(e.incident)&&(e.incident=["".concat(e.incident)]),void 0===e.offset?e.offset=0:e.offset=Number(e.offset[0]),void 0===e.limit?e.limit=20:e.limit=Number(e.limit[0]),void 0!==e.reboot&&!Array.isArray(e.reboot)&&(e.reboot=["".concat(e.reboot)]),void 0!==e.impacting&&!Array.isArray(e.impacting)&&(e.impacting=["".concat(e.impacting)]),Be(z(z({},ee),e))}fe(!1)}),[]),(0,f.useEffect)((function(){if(void 0!==ee.sort){var e=Number(Object.entries(Ke).find((function(e){return e[1]===ee.sort||"-".concat(e[1])===ee.sort}))[0]),t="-"===ee.sort[0]?"desc":"asc";se({index:e,direction:t})}}),[ee.sort]),(0,f.useEffect)((function(){if(Ie.data)if(0===Ie.data.length)le([{cells:[{title:d().createElement(T.Z,{icon:_.default,iconClass:"ansibleCheck",title:a.formatMessage(V.Z.rulesTableNoRuleHitsTitle),text:a.formatMessage(et(ee.rule_status))},"enabled"===ee.rule_status&&d().createElement(W.Button,{variant:"link",style:{paddingTop:24},onClick:function(){return Ue("all")}},a.formatMessage(V.Z.rulesTableNoRuleHitsAddDisabledButton))),props:{colSpan:6}}]}]);else{var e=Ie.data.flatMap((function(e,t){return[{isOpen:De,rule:e,cells:[{title:d().createElement("span",{key:t},d().createElement(u.Link,{key:t,to:"/recommendations/".concat(e.rule_id)}," ",e.description," "),d().createElement(R.Z,{rule:e}))},{title:d().createElement(P.Z,{key:t,date:e.publish_date,variant:"relative"})},{title:d().createElement(Z.Z,{key:t,labelList:[e.category]})},{title:d().createElement("div",{key:t},d().createElement(g.Tooltip,{key:t,position:g.TooltipPosition.bottom,content:a.formatMessage(V.Z.rulesDetailsTotalriskBody,{risk:c.Nq[e.total_risk]||a.formatMessage(V.Z.undefined),strong:function(e){return(0,F.f)(e)}})},d().createElement(x.Z,{value:e.total_risk})))},{title:d().createElement("div",{key:t},d().createElement(x.Z,{text:c.MS[$e(e)],value:$e(e),hideIcon:!0}),d().createElement("div",null))},{title:"rhdisabled"===e.rule_status?d().createElement(g.Tooltip,{content:a.formatMessage(V.Z.byEnabling,{systems:e.impacted_systems_count})},d().createElement("span",null,a.formatMessage(V.Z.nA))):d().createElement("div",{key:t},"".concat(e.impacted_systems_count.toLocaleString()))},{title:d().createElement("div",{className:"ins-c-center-text ",key:t},e.playbook_count?d().createElement(_.default,{className:"ansibleCheck"}):a.formatMessage(V.Z.no))}]},{parent:2*t,fullWidth:!0,cells:[{title:d().createElement(O.Z,{className:"pf-m-light"},d().createElement(p.Stack,{hasGutter:!0},e.hosts_acked_count?d().createElement(p.StackItem,null,d().createElement(h.ZP,{size:"sm"})," ",e.hosts_acked_count&&!e.impacted_systems_count?a.formatMessage(V.Z.ruleIsDisabledForAllSystems):a.formatMessage(V.Z.ruleIsDisabledForSystemsBody,{systems:e.hosts_acked_count})," "," ",d().createElement(W.Button,{isInline:!0,variant:"link",ouiaId:"viewSystem",onClick:function(){we(e),xe(!0)}},a.formatMessage(V.Z.viewSystems))):d().createElement(d().Fragment,null),d().createElement(A.Z,{rule:e,resolutionRisk:$e(e),riskOfChangeDesc:c.wY[$e(e)]})))}]}]}));le(e)}}),[Ie]),(0,f.useEffect)((function(){if(!me&&!Ge){var e=z({},ee),t=be.length?{text:be}:{};delete e.text,Be(z(z(z({},e),t),{},{offset:0}))}}),[Ye]);var tt,at=function(e){var t=z(z({},ee),{},{offset:0});"text"===e&&ge(""),delete t[e],Be(t)},rt=function(e,t){t.length>0?Be(z(z({},ee),{},{offset:0},(0,n.Z)({},e,t))):at(e)},lt=[{label:a.formatMessage(V.Z.name).toLowerCase(),filterValues:{key:"text-filter",onChange:function(e,t){return ge(t)},value:be,placeholder:a.formatMessage(V.Z.filterBy)}},{label:c.W2.total_risk.title,type:c.W2.total_risk.type,id:c.W2.total_risk.urlParam,value:"checkbox-".concat(c.W2.total_risk.urlParam),filterValues:{key:"".concat(c.W2.total_risk.urlParam,"-filter"),onChange:function(e,t){return rt(c.W2.total_risk.urlParam,t)},value:ee.total_risk,items:c.W2.total_risk.values}},{label:c.W2.res_risk.title,type:c.W2.res_risk.type,id:c.W2.res_risk.urlParam,value:"checkbox-".concat(c.W2.res_risk.urlParam),filterValues:{key:"".concat(c.W2.res_risk.urlParam,"-filter"),onChange:function(e,t){return rt(c.W2.res_risk.urlParam,t)},value:ee.res_risk,items:c.W2.res_risk.values}},{label:c.W2.impact.title,type:c.W2.impact.type,id:c.W2.impact.urlParam,value:"checkbox-".concat(c.W2.impact.urlParam),filterValues:{key:"".concat(c.W2.impact.urlParam,"-filter"),onChange:function(e,t){return rt(c.W2.impact.urlParam,t)},value:ee.impact,items:c.W2.impact.values}},{label:c.W2.likelihood.title,type:c.W2.likelihood.type,id:c.W2.likelihood.urlParam,value:"checkbox-".concat(c.W2.likelihood.urlParam),filterValues:{key:"".concat(c.W2.likelihood.urlParam,"-filter"),onChange:function(e,t){return rt(c.W2.likelihood.urlParam,t)},value:ee.likelihood,items:c.W2.likelihood.values}},{label:c.W2.category.title,type:c.W2.category.type,id:c.W2.category.urlParam,value:"checkbox-".concat(c.W2.category.urlParam),filterValues:{key:"".concat(c.W2.category.urlParam,"-filter"),onChange:function(e,t){return rt(c.W2.category.urlParam,t)},value:ee.category,items:c.W2.category.values}},{label:c.W2.incident.title,type:c.W2.incident.type,id:c.W2.incident.urlParam,value:"checkbox-".concat(c.W2.incident.urlParam),filterValues:{key:"".concat(c.W2.incident.urlParam,"-filter"),onChange:function(e,t){return rt(c.W2.incident.urlParam,t)},value:ee.incident,items:c.W2.incident.values}},{label:c.W2.has_playbook.title,type:c.W2.has_playbook.type,id:c.W2.has_playbook.urlParam,value:"checkbox-".concat(c.W2.has_playbook.urlParam),filterValues:{key:"".concat(c.W2.has_playbook.urlParam,"-filter"),onChange:function(e,t){return rt(c.W2.has_playbook.urlParam,t)},value:ee.has_playbook,items:c.W2.has_playbook.values}},{label:c.W2.reboot.title,type:c.W2.reboot.type,id:c.W2.reboot.urlParam,value:"checkbox-".concat(c.W2.reboot.urlParam),filterValues:{key:"".concat(c.W2.reboot.urlParam,"-filter"),onChange:function(e,t){return rt(c.W2.reboot.urlParam,t)},value:ee.reboot,items:c.W2.reboot.values}},{label:c.W2.rule_status.title,type:c.W2.rule_status.type,id:c.W2.rule_status.urlParam,value:"radio-".concat(c.W2.rule_status.urlParam),filterValues:{key:"".concat(c.W2.rule_status.urlParam,"-filter"),onChange:function(e,t){return Ue(t)},value:"".concat(ee.rule_status),items:c.W2.rule_status.values}},{label:c.W2.impacting.title,type:c.W2.impacting.type,id:c.W2.impacting.urlParam,value:"checkbox-".concat(c.W2.impacting.urlParam),filterValues:{key:"".concat(c.W2.impacting.urlParam,"-filter"),onChange:function(e,t){return rt(c.W2.impacting.urlParam,t)},value:ee.impacting,items:c.W2.impacting.values}}],nt={deleteTitle:a.formatMessage(V.Z.resetFilters),filters:(tt=z({},ee),delete tt.topic,delete tt.sort,delete tt.offset,delete tt.limit,(0,y.yK)(tt,c.W2)),onDelete:function(e,t,a){a?(ge(""),Be(z(z({},ee.topic&&{topic:ee.topic}),{},{impacting:["true"],rule_status:"enabled",limit:ee.limit,offset:ee.offset}))):t.map((function(e){var t=(0,n.Z)({},e.urlParam,Array.isArray(ee[e.urlParam])?ee[e.urlParam].filter((function(t){return String(t)!==String(e.chips[0].value)})):"");t[e.urlParam].length>0?Be(z(z({},ee),t)):at(e.urlParam)}))}};return d().createElement(d().Fragment,null,Se&&d().createElement(D.Z,{handleModalToggle:function(e){return xe(e)},isModalOpen:Se,afterFn:function(){ze()},rule:Te}),ve&&d().createElement(M.Z,{handleModalToggle:he,isModalOpen:ve,rule:_e,afterFn:ze}),d().createElement(w.Z,{expandAll:{isAllExpanded:De,onClick:function(e,t){var a=(0,l.Z)(re);Ne(t),a.map((function(e,r){Object.prototype.hasOwnProperty.call(e,"isOpen")&&(a[r]=z(z({},e),{},{isOpen:t}))})),le(a)}},pagination:{itemCount:Je,page:ee.offset/ee.limit+1,perPage:Number(ee.limit),onSetPage:function(e,t){Qe(t)},onPerPageSelect:function(e,t){Be(z(z({},ee),{},{limit:t,offset:0}))},isCompact:!0},exportConfig:(t={label:a.formatMessage(V.Z.exportCsv)},(0,n.Z)(t,"label",a.formatMessage(V.Z.exportJson)),(0,n.Z)(t,"onSelect",(function(e,t){return(0,B.Z)("hits",t,ee,Q,U,X)})),(0,n.Z)(t,"isDisabled",!Y||!ee.impacting||Array.isArray(ee.impacting)&&!ee.impacting.every((function(e){return"true"===e}))),(0,n.Z)(t,"tooltipText",Y?a.formatMessage(V.Z.exportData):a.formatMessage(V.Z.permsAction)),t),filterConfig:{items:lt},activeFiltersConfig:nt}),Le?d().createElement(C.Z,null):qe?d().createElement(S.Z,{message:a.formatMessage(V.Z.rulesTableFetchRulesError)}):d().createElement(b.Table,{"aria-label":"rule-table",variant:b.TableVariant.compact,actionResolver:function(e,t){var r=t.rowIndex,l=re[r].rule?re[r].rule:null;return r%2==0&&l?l&&"enabled"===l.rule_status?[{title:a.formatMessage(V.Z.disableRule),onClick:function(e,t){return Xe(t)}}]:[{title:a.formatMessage(V.Z.enableRule),onClick:function(e,t){return Xe(t)}}]:null},onCollapse:function(e,t,a){var r=(0,l.Z)(re);r[t]=z(z({},r[t]),{},{isOpen:a}),le(r)},sortBy:oe,onSort:function(e,t,a){var r="".concat("asc"===a?"":"-").concat(Ke[t]);se({index:t,direction:a}),Be(z(z({},ee),{},{sort:r,offset:0}))},cells:$,rows:re,areActionsDisabled:function(){return!J},isStickyHeader:!0},d().createElement(b.TableHeader,null),d().createElement(b.TableBody,null)),d().createElement(m.tl,{ouiaId:"page",itemCount:Je,page:ee.offset/ee.limit+1,perPage:Number(ee.limit),onSetPage:function(e,t){Qe(t)},onPerPageSelect:function(e,t){Be(z(z({},ee),{},{limit:t,offset:0}))},widgetId:"pagination-options-menu-bottom",variant:m.aM.bottom}))}}}]);
//# sourceMappingURL=../sourcemaps/RulesTable.74e3f2eb8a95acefeae4864bdadb2c91.js.map