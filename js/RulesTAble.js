(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{608:function(e,t,a){"use strict";a.r(t);var r=a(160),n=a.n(r),l=a(271),o=a.n(l),i=a(159),s=a.n(i),c=a(548),u=a.n(c),f=a(270),E=a.n(f),m=a(519),p=a(238),d=a(211),b=a(233),R=a(172),T=a(144),_=a(286),O=a(346),g=a(363),I=a(2),h=a.n(I),S=a(322),v=a(323),y=a(43),k=a(347),C=a(345),A=a(544),F=a(14),j=a(575),L=a(547),w=a(97),P=a(530),G=a(528),M=a(1),x=a.n(M),N=a(620),H=a(82),B=a(96),D=a(609),V=a(27),z=a(29),J=a(517),U=a.n(J),W=a(269),q=a.n(W);function K(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Q(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?K(Object(a),!0).forEach((function(t){s()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):K(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var X=function(e){var t=e.rules,a=e.filters,r=e.rulesFetchStatus,l=e.setFilters,i=e.fetchRules,c=e.addNotification,f=e.history,m=e.intl,M=Object(I.useState)([{title:m.formatMessage(z.a.description),transforms:[S.a]},{title:m.formatMessage(z.a.added),transforms:[S.a,Object(v.a)(15)]},{title:m.formatMessage(z.a.totalRisk),transforms:[S.a]},{title:m.formatMessage(z.a.systems),transforms:[S.a]},{title:h.a.createElement(h.a.Fragment,null,h.a.createElement(p.b,{size:"md"})," ",m.formatMessage(z.a.ansible)),transforms:[S.a],dataLabel:m.formatMessage(z.a.ansible)}]),x=E()(M,1)[0],H=Object(I.useState)([]),B=E()(H,2),V=B[0],J=B[1],W=Object(I.useState)({}),q=E()(W,2),K=q[0],X=q[1],Y=Object(I.useState)("-publish_date"),Z=E()(Y,2),$=Z[0],ee=Z[1],te=Object(I.useState)(a.impacting),ae=E()(te,2),re=ae[0],ne=ae[1],le=Object(I.useState)(10),oe=E()(le,2),ie=oe[0],se=oe[1],ce=Object(I.useState)(0),ue=E()(ce,2),fe=ue[0],Ee=ue[1],me=Object(I.useState)(!0),pe=E()(me,2),de=pe[0],be=pe[1],Re=Object(I.useState)(""),Te=E()(Re,2),_e=Te[0],Oe=Te[1],ge=Object(I.useState)(""),Ie=E()(ge,2),he=Ie[0],Se=Ie[1],ve=Object(I.useState)(!1),ye=E()(ve,2),ke=ye[0],Ce=ye[1],Ae=Object(I.useState)({}),Fe=E()(Ae,2),je=Fe[0],Le=Fe[1],we=Object(D.a)(he,800),Pe=t.meta?t.meta.count:0,Ge=function(e){return Object.assign.apply(Object,[{}].concat(u()(Object.entries(e).map((function(e){return Array.isArray(e[1])?s()({},e[0],e[1].join()):s()({},e[0],e[1])})))))},Me=function(){i(Q({},Ge(a),{offset:0,limit:ie,impacting:re,sort:$}))},xe=Object(I.useCallback)((function(e,t,a){var r="".concat("asc"===a?"":"-").concat({1:"description",2:"publish_date",3:"total_risk",4:"impacted_count",5:"playbook_count"}[t]);X({index:t,direction:a}),ee(r),Ee(0)}),[ee,X,Ee]),Ne=function(e){Ee(e*ie-ie)},He=function(){var e=o()(n.a.mark((function e(t){var a;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=V[t].rule,e.prev=1,!a.reports_shown){e.next=7;break}Le(a),Ce(!0),e.next=10;break;case 7:return e.next=9,A.a.delete("".concat(F.BASE_URL,"/ack/").concat(a.rule_id,"/"));case 9:Me();case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),c({variant:"danger",dismissable:!0,title:a.reports_shown?m.formatMessage(z.a.rulesTableHideReportsErrorDisabled):m.formatMessage(z.a.rulesTableHideReportsErrorEnabled),description:"".concat(e.t0)});case 15:case"end":return e.stop()}}),e,null,[[1,12]])})));return function(t){return e.apply(this,arguments)}}(),Be=Object(I.useCallback)((function(){Ee(0)}),[]);Object(I.useEffect)((function(){if(f.location.search){var e=new URLSearchParams(f.location.search),t=Array.from(e).reduce((function(e,t){var a=E()(t,2),r=a[0],n=a[1];return Q({},e,s()({},r,"true"===n||"false"===n?JSON.parse(n):n.split(",")))}),{});t.reports_shown=void 0===t.reports_shown||"undefined"===t.reports_shown[0]?void 0:t.reports_shown,ne(t.impacting),l(Q({},t))}be(!1)}),[]),Object(I.useEffect)((function(){var e=Object.keys(a).map((function(e){return"".concat(e,"=").concat(Array.isArray(a[e])?a[e].join():a[e])})).join("&");Oe("?".concat(e)),f.replace({search:"?".concat(e)})}),[a,f]),Object(I.useEffect)((function(){de||i(Q({},Ge(a),{offset:fe,limit:ie,sort:$}))}),[i,de,a,ie,fe,$]),Object(I.useEffect)((function(){V.length||xe(null,2,"desc")}),[xe,V.length]),Object(I.useEffect)((function(){if(t.data)if(0===t.data.length)J([{cells:[{title:h.a.createElement(G.a,{icon:d.b,iconClass:"ansibleCheck",size:"sm",title:m.formatMessage(z.a.rulesTableNoRuleHitsTitle),text:a.reports_shown?m.formatMessage(z.a.rulesTableNoRuleHitsEnabledRulesBody):m.formatMessage(z.a.rulesTableNoRuleHitsAnyRulesBody)},a.reports_shown&&h.a.createElement(T.a,{variant:"link",style:{paddingTop:24},onClick:function(){l(Q({},a,{reports_shown:void 0})),Be()}},m.formatMessage(z.a.rulesTableNoRuleHitsAddDisabledButton))),props:{colSpan:5}}]}]);else{var e=t.data.flatMap((function(e,t){return[{isOpen:!1,rule:e,cells:[{title:h.a.createElement("span",{key:t},!e.reports_shown&&h.a.createElement(_.a,{isRead:!0},h.a.createElement(b.b,{size:"md"}),"Â ",m.formatMessage(z.a.disabled)),h.a.createElement(w.Link,{key:t,to:"/rules/".concat(e.rule_id)}," ",e.description," "))},{title:h.a.createElement("div",{key:t},U()(e.publish_date).fromNow())},{title:h.a.createElement("div",{className:"pf-m-center",key:t,style:{verticalAlign:"top"}},h.a.createElement(g.Battery,{label:m.formatMessage(z.a.totalRisk),labelHidden:!0,severity:e.total_risk}))},{title:h.a.createElement("div",{key:t}," ",e.reports_shown?"".concat(e.impacted_systems_count.toLocaleString()):m.formatMessage(z.a.nA))},{title:h.a.createElement("div",{className:"pf-m-center ",key:t},e.playbook_count?h.a.createElement(R.b,{className:"ansibleCheck"}):m.formatMessage(z.a.no))}]},{parent:2*t,fullWidth:!0,cells:[{title:h.a.createElement(g.Main,{className:"pf-m-light"}," ",h.a.createElement(N.a,{rule:e}))}]}]}));J(e.asMutable())}}),[Be,a,t,l]),Object(I.useEffect)((function(){void 0===a.text?Se(""):Se(a.text)}),[a.text]),Object(I.useEffect)((function(){if(!de){var e=Q({},a),t=he.length?{text:he}:{};delete e.text,l(Q({},e,{},t))}}),[we]);var De=function(e){var t=Q({},a);delete t[e],l(t)},Ve=function(e,t){t.length>0?l(Q({},a,{},s()({},e,t))):De(e)},ze=["",{label:m.formatMessage(re?z.a.rulesTableActionShow:z.a.rulesTableActionHide),onClick:function(){return function(e){l(Q({},a,{impacting:e})),ne(e),Ee(0)}(!re)}}],Je=[{label:m.formatMessage(z.a.description),filterValues:{key:"text-filter",onChange:function(e,t){return Se(t)},value:he}},{label:F.FILTER_CATEGORIES.total_risk.title,type:F.FILTER_CATEGORIES.total_risk.type,id:F.FILTER_CATEGORIES.total_risk.urlParam,value:"checkbox-".concat(F.FILTER_CATEGORIES.total_risk.urlParam),filterValues:{key:"".concat(F.FILTER_CATEGORIES.total_risk.urlParam,"-filter"),onChange:function(e,t){return Ve(F.FILTER_CATEGORIES.total_risk.urlParam,t)},value:a.total_risk,items:F.FILTER_CATEGORIES.total_risk.values}},{label:F.FILTER_CATEGORIES.res_risk.title,type:F.FILTER_CATEGORIES.res_risk.type,id:F.FILTER_CATEGORIES.res_risk.urlParam,value:"checkbox-".concat(F.FILTER_CATEGORIES.res_risk.urlParam),filterValues:{key:"".concat(F.FILTER_CATEGORIES.res_risk.urlParam,"-filter"),onChange:function(e,t){return Ve(F.FILTER_CATEGORIES.res_risk.urlParam,t)},value:a.res_risk,items:F.FILTER_CATEGORIES.res_risk.values}},{label:F.FILTER_CATEGORIES.impact.title,type:F.FILTER_CATEGORIES.impact.type,id:F.FILTER_CATEGORIES.impact.urlParam,value:"checkbox-".concat(F.FILTER_CATEGORIES.impact.urlParam),filterValues:{key:"".concat(F.FILTER_CATEGORIES.impact.urlParam,"-filter"),onChange:function(e,t){return Ve(F.FILTER_CATEGORIES.impact.urlParam,t)},value:a.impact,items:F.FILTER_CATEGORIES.impact.values}},{label:F.FILTER_CATEGORIES.likelihood.title,type:F.FILTER_CATEGORIES.likelihood.type,id:F.FILTER_CATEGORIES.likelihood.urlParam,value:"checkbox-".concat(F.FILTER_CATEGORIES.likelihood.urlParam),filterValues:{key:"".concat(F.FILTER_CATEGORIES.likelihood.urlParam,"-filter"),onChange:function(e,t){return Ve(F.FILTER_CATEGORIES.likelihood.urlParam,t)},value:a.likelihood,items:F.FILTER_CATEGORIES.likelihood.values}},{label:F.FILTER_CATEGORIES.category.title,type:F.FILTER_CATEGORIES.category.type,id:F.FILTER_CATEGORIES.category.urlParam,value:"checkbox-".concat(F.FILTER_CATEGORIES.category.urlParam),filterValues:{key:"".concat(F.FILTER_CATEGORIES.category.urlParam,"-filter"),onChange:function(e,t){return Ve(F.FILTER_CATEGORIES.category.urlParam,t)},value:a.category,items:F.FILTER_CATEGORIES.category.values}},{label:F.FILTER_CATEGORIES.reports_shown.title,type:F.FILTER_CATEGORIES.reports_shown.type,id:F.FILTER_CATEGORIES.reports_shown.urlParam,value:"radio-".concat(F.FILTER_CATEGORIES.reports_shown.urlParam),filterValues:{key:"".concat(F.FILTER_CATEGORIES.reports_shown.urlParam,"-filter"),onChange:function(e,t){return l(Q({},a,{reports_shown:"undefined"===(r=t)?void 0:r})),void Ee(0);var r},value:void 0===a.reports_shown?"undefined":"".concat(a.reports_shown),items:F.FILTER_CATEGORIES.reports_shown.values}}],Ue={filters:function(){var e=Q({},a);delete e.text,delete e.impacting,delete e.reports_shown,delete e.topic;var t=Object.entries(e);return t.length>0?t.map((function(e){var t=F.FILTER_CATEGORIES[e[0]],a=Array.isArray(e[1])?e[1].map((function(e){return{name:t.values.find((function(t){return t.value===String(e)})).label,value:e}})):[{name:t.values.find((function(t){return t.value===String(e[1])})).label,value:e[1]}];return{category:t.title,chips:a,urlParam:t.urlParam}})):[]}(),onDelete:function(e,t,r){r?l({impacting:!0,reports_shown:"true"}):t.map((function(e){var t=s()({},e.urlParam,a[e.urlParam].filter((function(t){return Number(t)!==Number(e.chips[0].value)})));t[e.urlParam].length>0?l(Q({},a,{},t)):De(e.urlParam)}))}};return h.a.createElement(h.a.Fragment,null,ke&&h.a.createElement(j.a,{handleModalToggle:Ce,isModalOpen:ke,rule:je,afterFn:Me}),h.a.createElement(g.PrimaryToolbar,{pagination:{itemCount:Pe,page:fe/ie+1,perPage:ie,onSetPage:function(e,t){Ne(t)},onPerPageSelect:function(e,t){se(t)},isCompact:!1},exportConfig:{onSelect:function(e,t){return window.location="".concat(F.BASE_URL,"/export/hits.").concat("json"===t?"json":"csv","/").concat(_e)}},actionsConfig:{actions:ze},filterConfig:{items:Je},activeFiltersConfig:Ue}),"fulfilled"===r&&h.a.createElement(y.b,{"aria-label":"rule-table",actionResolver:function(e,t){var a=t.rowIndex,r=V[a].rule?V[a].rule:null;return a%2==0&&r?r&&r.reports_shown?[{title:m.formatMessage(z.a.disableRule),onClick:function(e,t){return He(t)}}]:[{title:m.formatMessage(z.a.enableRule),onClick:function(e,t){return He(t)}}]:null},onCollapse:function(e,t,a){var r=u()(V);r[t]=Q({},r[t],{isOpen:a}),J(r)},sortBy:K,onSort:xe,cells:x,rows:V},h.a.createElement(k.a,null),h.a.createElement(C.a,null)),"pending"===r&&h.a.createElement(P.a,null),"failed"===r&&h.a.createElement(L.a,{message:m.formatMessage(z.a.rulesTableFetchRulesError)}),h.a.createElement(g.TableToolbar,null,h.a.createElement(O.a,{itemCount:Pe,perPage:ie,page:fe/ie+1,onSetPage:function(e,t){Ne(t)},widgetId:"pagination-options-menu-bottom",variant:O.b.bottom})))};X.propTypes={fetchRules:x.a.func,rulesFetchStatus:x.a.string,rules:x.a.object,filters:x.a.object,addNotification:x.a.func,setFilters:x.a.func,history:x.a.object,intl:x.a.any};t.default=Object(V.c)(q()(Object(B.connect)((function(e,t){return Q({rules:e.AdvisorStore.rules,rulesFetchStatus:e.AdvisorStore.rulesFetchStatus,filters:e.AdvisorStore.filters},t)}),(function(e){return{fetchRules:function(t){return e(m.d(t))},addNotification:function(t){return e(Object(H.addNotification)(t))},setFilters:function(t){return e(m.l(t))}}}))(X)))}}]);
//# sourceMappingURL=RulesTAble.js.map