(self.webpackChunkadvisor_frontend=self.webpackChunkadvisor_frontend||[]).push([[993],{40444:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>K});var s=r(96156),a=r(28481),n=r(57149),o=r(59303),i=r(93264),l=r.n(i),c=r(9942),u=r(97109),f=r(88931),m=r(76341),p=r(33739),y=r(46891),d=r(85061),g=r(92137),v=r(87757),b=r.n(v),h=r(3968),E=r(74093),S=r(45697),O=r.n(S),Z=r(51634),w=r(39080),_=r(87119),T=r(75442),P=r(23992),x=r(71712),M=r(32412),j=r(30893);function k(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function A(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?k(Object(r),!0).forEach((function(t){(0,s.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):k(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var C=E.mM.create({bold:{fontWeight:P.default.value},link:{color:x.ZP.value},text:{marginTop:M.ZP.value},nameColumn:{width:"220px"},header:{fontSize:9,color:T.ZP.value,paddingLeft:w.ZP.value,paddingBottom:Z.ZP.value,paddingTop:_.ZP.value}}),D=function(e){var t=e.page,r=e.systems,s=e.intl,n=[{value:s.formatMessage(j.Z.name),style:C.nameColumn},{value:s.formatMessage(j.Z.recommendations),style:{width:"100px",textAlign:"center"}},{value:s.formatMessage(j.Z.critical),style:{width:"70px",textAlign:"center"}},{value:s.formatMessage(j.Z.important),style:{width:"70px",textAlign:"center"}},{value:s.formatMessage(j.Z.moderate),style:{width:"60px",textAlign:"center"}},{value:s.formatMessage(j.Z.low),style:{width:"90px",textAlign:"center"}},{value:s.formatMessage(j.Z.lastSeen),style:{marginLeft:"20px"}}],o=["hits","critical_hits","important_hits","moderate_hits","low_hits"],i=(0,d.Z)(r.map((function(e){var t=new Date(e.last_seen).toUTCString().split(" "),r=(0,a.Z)(t,5),s=r[1],n=r[2],i=r[3],c=r[4],u="".concat(s," ").concat(n," ").concat(i,", ").concat(c.split(":").slice(0,2).join(":")," UTC");return[l().createElement(E.xv,{key:e.system_uuid,style:C.nameColumn},l().createElement(E.rU,{style:C.link,src:"https://cloud.redhat.com/insights/advisor/systems/".concat(e.system_uuid,"/")},e.display_name))].concat((0,d.Z)(o.map((function(t){return s=(r={style:{width:"10px"},value:e[t]}).value,a=r.style,l().createElement(E.xv,{style:a},s);var r,s,a}))),[l().createElement(E.xv,{key:e.last_seen,style:{width:"100px"}},"".concat(u))])})));return l().createElement(l().Fragment,{key:t},l().createElement(h.sg,null,l().createElement(h.iA,{withHeader:!0,rows:[n.map((function(e){return r=(t=e).value,s=t.style,l().createElement(E.xv,{style:A(A(A({},s),C.header),C.bold)},r);var t,r,s}))].concat((0,d.Z)(i))})))};D.propTypes={systems:O().object,page:O().number,intl:O().any};var I=function(e){var t=e.systemsTotal,r=e.systems,s=e.filters,a=e.tags,n=e.intl;return delete s.offset,delete s.limit,l().createElement(l().Fragment,{key:"".concat(n.formatMessage(j.Z.insightsHeader),": ").concat(n.formatMessage(j.Z.systems))},l().createElement(E.xv,{key:"sys-count",style:C.text},n.formatMessage(j.Z.sysTableCount,{systems:l().createElement(E.xv,{key:"sys-count-count",style:C.bold},n.formatMessage(j.Z.execReportHeaderSystems,{systems:t}),t>1e3&&n.formatMessage(j.Z.dueTo))})),l().createElement(E.xv,{key:"sys-filters",style:C.text},n.formatMessage(j.Z.filtersApplied)),l().createElement(E.xv,{key:"sys-filters-values",style:C.bold},Object.entries(s).map((function(e){return l().createElement(E.xv,{key:e},"".concat(e[0],": ").concat(e[1],"     "))}))),l().createElement(E.xv,{key:"sys-tags",style:C.text},n.formatMessage(j.Z.tagsApplied)),l().createElement(E.xv,{key:"sys-tags-values",style:C.bold},a?decodeURIComponent(a):n.formatMessage(j.Z.noTags)),l().createElement(h.$0,{key:"systems",title:"Systems"},D({systems:r,intl:n})))};I.propTypes={systems:O().object,systemsTotal:O().number,filters:O().object,tags:O().array,intl:O().any};var R=r(71094),L=r(86896);function F(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function N(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?F(Object(r),!0).forEach((function(t){(0,s.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):F(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Y=function(e){var t=e.filters,r=(0,L.Z)(),s=(0,i.useState)(!1),n=(0,a.Z)(s,2),c=n[0],m=n[1],p=(0,f.useSelector)((function(e){return e.AdvisorStore.selectedTags})),y=(0,f.useSelector)((function(e){return e.AdvisorStore.workloads})),v=(0,f.useSelector)((function(e){return e.AdvisorStore.SID})),E=function(){var e=(0,g.Z)(b().mark((function e(){var s,a,n,i;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m(!0),s=p.length&&{tags:p},y&&(s=N(N({},s),(0,u.s0)(y,v))),e.next=5,R.Z.get("".concat(o.BASE_URL,"/export/systems/"),{},N(N({},t),s));case 5:return a=e.sent.data,n=I({systemsTotal:null==a?void 0:a.length,systems:a.slice(0,18),filters:t,tags:p,intl:r}),i=a.slice(18,982).reduce((function(e,t,r){var s=Math.floor(r/31);return!e[s]&&(e[s]=[]),e[s].push(t),e}),[]),m(!1),e.abrupt("return",[n].concat((0,d.Z)(i.map((function(e,t){return D({page:t,systems:e,intl:r})})))));case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,i.useMemo)((function(){return l().createElement(h.o6,{groupName:r.formatMessage(j.Z.redHatInsights),allPagesHaveTitle:!1,label:c?r.formatMessage(j.Z.loading):r.formatMessage(j.Z.exportPdf),asyncFunction:E,buttonProps:N({variant:"",component:"button",className:"pf-c-dropdown__menu-item systemsPdfOverride"},c?{isDisabled:!0}:null),reportName:"".concat(r.formatMessage(j.Z.insightsHeader),":"),type:r.formatMessage(j.Z.systems),fileName:"Advisor_systems--".concat((new Date).toUTCString().replace(/ /g,"-"),".pdf"),size:[841.89,595.28]})}),[c])};Y.propTypes={filters:O().object,systemsCount:O().number};const G=Y;var H=r(40609),U=r(58921),V=r(67336),W=r(75989),B=r(16530),q=r(43707);function z(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function J(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?z(Object(r),!0).forEach((function(t){(0,s.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):z(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const K=function(){var e,t=(0,L.Z)(),r=(0,f.useDispatch)(),d=(0,B.useLocation)().search,g=(0,f.useSelector)((function(e){return e.AdvisorStore.systems})),v=(0,f.useSelector)((function(e){return e.AdvisorStore.systemsFetchStatus})),b=(0,f.useSelector)((function(e){return e.AdvisorStore.filtersSystems})),h=(0,f.useSelector)((function(e){return e.AdvisorStore.selectedTags})),E=(0,f.useSelector)((function(e){return e.AdvisorStore.workloads})),S=(0,f.useSelector)((function(e){return e.AdvisorStore.SID})),O=function(e){return r(n.aw(e))},Z=(0,q.T)("advisor",o.PERMS.export).hasAccess,w=(0,i.useRef)(null),_=g.meta?g.meta.count:0,T=(0,i.useState)(b.display_name||""),P=(0,a.Z)(T,2),x=P[0],M=P[1],k=(0,H.Z)(x,o.DEBOUNCE_DELAY),A=(0,i.useState)(!0),C=(0,a.Z)(A,2),D=C[0],I=C[1],R={0:"display_name",2:"hits",3:"critical_hits",4:"important_hits",5:"moderate_hits",6:"low_hits",7:"last_seen"},F=[{title:t.formatMessage(j.Z.numberRuleHits),transforms:[c.sortable,c.wrappable],key:"hits"},{title:t.formatMessage(j.Z.critical),transforms:[c.sortable,c.wrappable],key:"critical_hits"},{title:t.formatMessage(j.Z.important),transforms:[c.sortable,c.wrappable],key:"important_hits"},{title:t.formatMessage(j.Z.moderate),transforms:[c.sortable,c.wrappable],key:"moderate_hits"},{title:t.formatMessage(j.Z.low),transforms:[c.sortable,c.wrappable],key:"low_hits"}],N=function(){(0,u.Y4)(b,h);var e,t=h.length&&{tags:h};return E&&(t=J(J({},t),(0,u.s0)(E,S))),e=J(J({},(0,u.qW)(b)),t),r(n.lc(e))},Y=function(e){var t=J(J({},b),{},{offset:0});"text"===e&&M(""),delete t[e],"hits"===e&&void 0===t.hits&&(t.hits=["yes"]),O(t)},z=[{label:t.formatMessage(j.Z.name).toLowerCase(),filterValues:{key:"text-filter",onChange:function(e,t){return M(t)},value:x}},{label:o.SYSTEM_FILTER_CATEGORIES.hits.title.toLowerCase(),type:o.SYSTEM_FILTER_CATEGORIES.hits.type,id:o.SYSTEM_FILTER_CATEGORIES.hits.urlParam,value:"checkbox-".concat(o.SYSTEM_FILTER_CATEGORIES.hits.urlParam),filterValues:{key:"".concat(o.SYSTEM_FILTER_CATEGORIES.hits.urlParam,"-filter"),onChange:function(e,t){return function(e,t){"hits"===e&&t.length>1&&t.includes("yes")&&t.shift(),t.length>0?O(J(J({},b),{},{offset:0},(0,s.Z)({},e,t))):Y(e)}(o.SYSTEM_FILTER_CATEGORIES.hits.urlParam,t)},value:b.hits,items:o.SYSTEM_FILTER_CATEGORIES.hits.values}}],K={deleteTitle:t.formatMessage(j.Z.resetFilters),filters:(e=J({},b),e.hits&&e.hits.includes("yes")&&delete e.hits,delete e.sort,delete e.offset,delete e.limit,(0,u.yK)(e,o.SYSTEM_FILTER_CATEGORIES)),onDelete:function(e,t,r){r?(M(""),O({sort:b.sort,limit:b.limit,offset:b.offset,hits:["yes"]})):t.map((function(e){var t=(0,s.Z)({},e.urlParam,Array.isArray(b[e.urlParam])?b[e.urlParam].filter((function(t){return String(t)!==String(e.chips[0].value)})):"");t[e.urlParam].length>0?O(J(J({},b),t)):Y(e.urlParam)}))}};(0,i.useEffect)((function(){void 0===b.display_name?M(""):M(b.display_name)}),[b.display_name]),(0,i.useEffect)((function(){if(!D&&"pending"!==v){var e=J({},b);delete e.display_name,O(J(J(J({},e),x.length?{display_name:x}:{}),{},{offset:0}))}}),[k]),(0,i.useEffect)((function(){if(d&&D){var e=(0,u.yG)();delete e.tags,void 0!==e.sort&&(e.sort=e.sort[0]),void 0!==e.display_name&&(e.display_name=e.display_name[0]),void 0===e.hits&&(e.hits=["all"]),void 0===e.offset?e.offset=0:e.offset=Number(e.offset[0]),void 0===e.limit?e.limit=20:e.limit=Number(e.limit[0]),O(J(J({},b),e))}else void 0!==b.limit&&void 0!==b.offset&&void 0!==b.hits||O(J(J({},b),{},{offset:0,limit:20,hits:["all"]}));I(!1),N()}),[]),(0,i.useEffect)((function(){"pending"!==v&&N()}),[b,h,E,S]);var $,Q,X,ee=b.offset/b.limit+1,te=(Q=Number(null===($=Object.entries(R))||void 0===$?void 0:$.find((function(e){return e[1]===b.sort||"-".concat(e[1])===b.sort}))[0]),X="-"===b.sort[0]?"desc":"asc",{index:Q,key:7!==Q?R[Q]:"updated",direction:X});return"failed"!==v?l().createElement(p.Z,{disableDefaultColumns:!0,columns:function(e){return function(e){var t=e.filter((function(e){return"updated"===e.key})),r=e.filter((function(e){return"display_name"===e.key})),s=e.filter((function(e){return"system_profile"===e.key}));return r=J(J({},r[0]),{},{transforms:[c.sortable,c.wrappable],props:{isStatic:!0}}),t=J(J({},t[0]),{},{transforms:[c.sortable,c.wrappable],props:{width:20}}),[r,s=J(J({},s[0]),{},{transforms:[c.wrappable]})].concat(F,[t])}(e)},onLoad:function(e){var t=e.mergeWithEntities,r=e.INVENTORY_ACTION_TYPES,s=e.mergeWithDetail;(0,V.JH)().register(J(J({},t((0,W.Vy)(F,r),J({page:ee||1,perPage:b.limit||20},te))),s()))},tableProps:{isStickyHeader:!0,variant:c.TableVariant.compact},ref:w,items:("pending"!==v&&(null==g?void 0:g.data)||[]).map((function(e){return J(J({},e),{},{id:e.system_uuid})})),isFullView:!0,sortBy:te,onSort:function(e){var t=e.index,r=e.direction,s="".concat("asc"===r?"":"-").concat(R[t]);O(J(J({},b),{},{sort:s,offset:0}))},hasCheckbox:!1,page:ee,total:_,isLoaded:"fulfilled"===v,perPage:Number(b.limit),filterConfig:{items:z},activeFiltersConfig:K,exportConfig:{onSelect:function(e,t){return(0,U.Z)("systems",t,b,h,E,S)},extraItems:[l().createElement("li",{key:"download-pd",role:"menuitem"},l().createElement(G,{filters:J({},(0,u.qW)(b))}))],isDisabled:!Z,tooltipText:Z?t.formatMessage(j.Z.exportData):t.formatMessage(j.Z.permsAction)},fallback:y.Z}):"failed"===v&&l().createElement(m.Z,{message:t.formatMessage(j.Z.systemTableFetchError)})}}}]);
//# sourceMappingURL=../sourcemaps/SystemsTable.d89276a77a575153d10b.js.map